<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>XIAO: Big Power, Small Board - 4.2 TinyML Made Easy: Anomaly Detection &amp; Motion Classification</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter_4-3.html" rel="next">
<link href="./chapter_4-1.html" rel="prev">
<link href="./cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">XIAO: Big Power, Small Board</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://github.com/Mjrovai/XIAO_Big_Power_Small_Board-ebook" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="./XIAO--Big-Power,-Small-Board.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="./XIAO--Big-Power,-Small-Board.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter_4.html">Chapter 4: Project Practice Advanced - TinyML Applications</a></li><li class="breadcrumb-item"><a href="./chapter_4-2.html">4.2 TinyML Made Easy: Anomaly Detection &amp; Motion Classification</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about_book.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this Book</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Introduction to Hardware and Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.1 First Arduino program with Seeed Studio XIAO: Blink</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.2 Using the Button Switch on the XIAO Expansion Board to Control an LED Light</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.3 Transforming XIAO and its Expansion Board into a Morse Code Transmitter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.4 Monitor Knob Value Changes with Serial Monitor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.5 Controlling LED and Servo with a Knob</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.6 Displaying ‚ÄúHello World‚Äù on OLED</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Project Practice for Beginners - Introduction to Prototype Design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.1 Introduction to Product Prototype Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.2 Smart Hygrometer and Thermometer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.3 Surprise Gift Box Based on Light Sensor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.4 Rhythmic Dance with a Triaxial Accelerometer</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Intermediate Project Practice---Complex Projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.1 Smart Remote Control Door</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.2 Smart Watch</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.3 Air Piano</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.4 Implementing Wi-Fi Connection and Applications with XIAO ESP32C3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.5 Telemetry and Commands using the MQTT protocol with XIAO ESP32C3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: Project Practice Advanced - TinyML Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.1 Understanding TinyML and Edge Impulse Studio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">4.2 TinyML Made Easy: Anomaly Detection &amp; Motion Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.3 TinyML Made Easy: Sound Classification (KWS)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.4 TinyML Made Easy: Image Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.5 TinyML Made Easy: Object Detection</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Creative Experiments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_5-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5.1 Creative and useful XIAO projects</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about_authors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the authors</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#things-used-in-this-project" id="toc-things-used-in-this-project" class="nav-link active" data-scroll-target="#things-used-in-this-project">4.2.1 Things used in this project</a>
  <ul class="collapse">
  <li><a href="#hardware-components" id="toc-hardware-components" class="nav-link" data-scroll-target="#hardware-components">Hardware components</a></li>
  <li><a href="#software-apps-and-online-services" id="toc-software-apps-and-online-services" class="nav-link" data-scroll-target="#software-apps-and-online-services">Software apps and online services</a></li>
  </ul></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">4.2.2 Introduction</a></li>
  <li><a href="#xiao-nrf52840-sense" id="toc-xiao-nrf52840-sense" class="nav-link" data-scroll-target="#xiao-nrf52840-sense">4.2.3 XIAO nRF52840 Sense</a>
  <ul class="collapse">
  <li><a href="#connecting-the-xiao-nrf52840-sense-with-arduino-ide" id="toc-connecting-the-xiao-nrf52840-sense-with-arduino-ide" class="nav-link" data-scroll-target="#connecting-the-xiao-nrf52840-sense-with-arduino-ide">4.2.3.1 Connecting the XIAO nRF52840 Sense with Arduino IDE</a></li>
  <li><a href="#testing-the-microphone" id="toc-testing-the-microphone" class="nav-link" data-scroll-target="#testing-the-microphone">4.2.3.2 Testing the Microphone</a></li>
  <li><a href="#testing-the-imu" id="toc-testing-the-imu" class="nav-link" data-scroll-target="#testing-the-imu">4.2.3.3 Testing the IMU</a></li>
  </ul></li>
  <li><a href="#the-tinyml-motion-classification-model" id="toc-the-tinyml-motion-classification-model" class="nav-link" data-scroll-target="#the-tinyml-motion-classification-model">4.2.4 The TinyML Motion Classification Model</a>
  <ul class="collapse">
  <li><a href="#connecting-a-device-to-the-edge-impulse-studio" id="toc-connecting-a-device-to-the-edge-impulse-studio" class="nav-link" data-scroll-target="#connecting-a-device-to-the-edge-impulse-studio">4.2.4.1 Connecting a Device to the Edge Impulse Studio</a></li>
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">4.2.4.2 Data Collection</a></li>
  <li><a href="#data-pre-processing" id="toc-data-pre-processing" class="nav-link" data-scroll-target="#data-pre-processing">4.2.4.3 Data Pre-Processing</a></li>
  <li><a href="#model-design" id="toc-model-design" class="nav-link" data-scroll-target="#model-design">4.2.4.4 Model Design</a></li>
  <li><a href="#impulse-design" id="toc-impulse-design" class="nav-link" data-scroll-target="#impulse-design">4.2.4.5 Impulse Design</a></li>
  <li><a href="#generating-features" id="toc-generating-features" class="nav-link" data-scroll-target="#generating-features">4.2.4.6 Generating features</a></li>
  <li><a href="#training" id="toc-training" class="nav-link" data-scroll-target="#training">4.2.4.7 Training</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing">4.2.4.8 Testing</a></li>
  <li><a href="#live-classification" id="toc-live-classification" class="nav-link" data-scroll-target="#live-classification">4.2.4.9 Live Classification</a></li>
  <li><a href="#deployment" id="toc-deployment" class="nav-link" data-scroll-target="#deployment">4.2.4.10 Deployment</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">4.2.4.11 Inference</a></li>
  <li><a href="#post-processing" id="toc-post-processing" class="nav-link" data-scroll-target="#post-processing">Post-processing</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">4.2.4.12 Conclusion</a></li>
  <li><a href="#case-applications" id="toc-case-applications" class="nav-link" data-scroll-target="#case-applications">4.2.4.13 Case Applications</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Mjrovai/XIAO_Big_Power_Small_Board-ebook/edit/main/chapter_4-2.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/Mjrovai/XIAO_Big_Power_Small_Board-ebook/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/Mjrovai/XIAO_Big_Power_Small_Board-ebook/blob/main/chapter_4-2.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">4.2 TinyML Made Easy: Anomaly Detection &amp; Motion Classification</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><br></p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670489415530-2d597008-ee4f-42ca-b6e6-3e26fbe1082a.png#averageHue=%233d6160&clientId=ua1a1be23-670f-4&from=paste&height=509&id=ud9bbae99&originHeight=675&originWidth=900&originalType=binary&ratio=1&rotation=0&showTitle=false&size=721877&status=done&style=stroke&taskId=ucde57e5a-1bea-4028-876a-9c3d70061e5&title=&width=678) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_1.png" class="img-fluid"></p>
<section id="things-used-in-this-project" class="level2">
<h2 class="anchored" data-anchor-id="things-used-in-this-project">4.2.1 Things used in this project</h2>
<section id="hardware-components" class="level3">
<h3 class="anchored" data-anchor-id="hardware-components">Hardware components</h3>
<ul>
<li><a href="https://www.seeedstudio.com/Seeed-XIAO-BLE-Sense-nRF52840-p-5253.html">Seeed Studio XIAO nRF52840 Sense</a> √ó 1</li>
</ul>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1668492017246-6f04d198-1961-4f7b-a990-dd6937468025.png#averageHue=%23a6997f&clientId=u640cf75b-7515-4&from=paste&height=78&id=tGTo8&originHeight=650&originWidth=970&originalType=binary&ratio=1&rotation=0&showTitle=false&size=512355&status=done&style=none&taskId=u369408e4-7109-4379-8247-0698cf19286&title=&width=116) -->
<!-- ![](https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_2.png) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_2.png" width="300" height="auto"></p>
</section>
<section id="software-apps-and-online-services" class="level3">
<h3 class="anchored" data-anchor-id="software-apps-and-online-services">Software apps and online services</h3>
<ul>
<li><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_3.png" class="img-fluid"> <a href="https://www.hackster.io/arduino/products/arduino-ide?ref=project-958fd2">Arduino IDE</a></li>
</ul>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1669875695345-b20a52ba-5da7-4ce2-b21b-5ecb9b9802c3.png#averageHue=%23f3f4f1&clientId=u413b5b5e-84eb-4&from=paste&height=48&id=bESIK&originHeight=96&originWidth=96&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9015&status=done&style=none&taskId=u32e545f3-6819-4f99-b7ea-98db56952d2&title=&width=48) -->
<!-- <img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo//chapter_4-2/chapter_4-2_3.png" alt="verify-button.png" width="30" height="30" /> -->
<ul>
<li><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_4.png" class="img-fluid"> <a href="https://www.hackster.io/EdgeImpulse/products/edge-impulse-studio?ref=project-958fd2">Edge Impulse Studio</a></li>
</ul>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1669875769259-c9ab4bef-809a-4c6a-ad7a-aa9fb078eb9e.png#averageHue=%23cfe688&clientId=ud4d22600-5c37-4&from=paste&height=48&id=k6jic&originHeight=96&originWidth=96&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8524&status=done&style=none&taskId=uc8745d54-8c8b-4814-8de4-d9d8bbf9f31&title=&width=48) -->
</section>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">4.2.2 Introduction</h2>
<p>As you learned in the previous section, microcontrollers (MCUs) are very cheap electronic components, usually with just a few kilobytes of RAM, designed to use tiny amounts of energy. They can be found in almost any consumer, medical, automotive, and industrial device. Over 40 billion microcontrollers will be sold this year, and there are probably hundreds of billions in service nowadays. However, these devices get little attention because they‚Äôre often only used to replace the functionality of older electro-mechanical systems in cars, washing machines, or remote controls. More recently, with the Internet of Things (IoT) era, a significant part of those MCUs is generating ‚Äúquintillions‚Äù of data that, in its majority, is not used due to the high cost and complexity (bandwidth and latency) of data transmission.</p>
<p>On the other hand, in recent decades, we have seen a lot of development in Machine Learning models trained with vast amounts of data in very powerful and power-hungry mainframes. And what is happening today is that due to those developments, it is now possible to take noisy signals like images, audio, or accelerometers and extract meaning from them by using Machine Learning algorithms such as Neural Networks.</p>
<p>And what is more important is that we can run these algorithms on microcontrollers and sensors themselves using very little power, interpreting much more of those sensor data that we are currently ignoring. This is TinyML, a new technology that enables machine intelligence right next to the physical world.</p>
<blockquote class="blockquote">
<p>TinyML can have many exciting applications for the benefit of society at large.</p>
</blockquote>
<p>This section will explore TinyML, running on a robust and tiny device, the <a href="https://www.seeedstudio.com/Seeed-XIAO-BLE-Sense-nRF52840-p-5253.html">Seed XIAO nRF52840 Sense</a>Ôºàalso called XIAO BLE SenseÔºâ.</p>
</section>
<section id="xiao-nrf52840-sense" class="level2">
<h2 class="anchored" data-anchor-id="xiao-nrf52840-sense">4.2.3 XIAO nRF52840 Sense</h2>
<!-- ![](https://cdn.nlark.com/yuque/0/2023/jpeg/2392200/1685667766488-5d45158f-c85d-473a-81c6-689bae2433cc.jpeg)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_5.jpeg" class="img-fluid"></p>
<section id="mainfeatures" class="level4">
<h4 class="anchored" data-anchor-id="mainfeatures"><strong>MainFeatures</strong></h4>
<ul>
<li>Bluetooth 5.0 with onboard antenna</li>
<li>CPU: Nordic nRF52840, ARM¬Æ Cortex¬Æ-M4 32-bit processor with FPU, 64 MHz</li>
<li>Ultra-Low Power: Standby power consumption is less than 5ŒºA</li>
<li>Battery charging chip: Supports lithium battery charge and discharge management</li>
<li>2 MB flash</li>
<li>256 KB RAM</li>
<li>PDM microphone</li>
<li>6-axis LSM6DS3TR-C IMU</li>
<li>Ultra Small Size: 20 x 17.5mm, XIAO series classic form-factor for wearable devices</li>
<li>Rich interfaces: 1xUART, 1xI2C, 1xSPI, 1xNFC, 1xSWD, 11xGPIO(PWM), 6xADC</li>
<li>Single-sided components, surface mounting design</li>
</ul>
</section>
<section id="connecting-the-xiao-nrf52840-sense-with-arduino-ide" class="level3">
<h3 class="anchored" data-anchor-id="connecting-the-xiao-nrf52840-sense-with-arduino-ide">4.2.3.1 Connecting the XIAO nRF52840 Sense with Arduino IDE</h3>
<p>The simple way to test and use this device is using the <a href="https://www.arduino.cc/en/software">Arduino IDE</a>. Once you have the IDE installed on your machine, navigate to <code>File &gt; Preferences</code>, and fill in ‚ÄúAdditional Boards Manager URLs‚Äù with the URL below: <code>https://files.seeedstudio.com/arduino/package_seeeduino_boards_index.json</code></p>
<!-- ![L17-A1.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685668325841-b1c7f194-5308-41ad-8d5c-148f19e2fc40.png#averageHue=%23e3e7eb&clientId=u729ff438-6678-4&from=ui&id=uadf449c2&originHeight=1676&originWidth=2406&originalType=binary&ratio=2&rotation=0&showTitle=false&size=4453620&status=done&style=stroke&taskId=u0440f0e4-475d-4b3d-9162-c7f2bc9a320&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_6.png" class="img-fluid"></p>
<p>Now, navigate to <code>Tools‚ÜíBoard‚ÜíBoard Manager</code> in the top menu, and type in the filter keyword <code>seeed nrf52</code> in the search box.</p>
<p>You will see two installation packages: <code>Seeed nRF52 Boards</code> and <code>Seeed nRF52 mbed-enabled Boards</code>, the differences between these two packages are as follows:</p>
<ul>
<li><code>Seeed nRF52 Boards</code>: Friendly for Bluetooth and low-power compatibility, suitable for Bluetooth and low power applications.</li>
<li><code>Seeed nRF52 mbed-enabled Boards</code>: Friendly for TinyML support, suitable for making TinyML or Bluetooth-related projects, but not suitable for applications with high low-power requirements.</li>
</ul>
<p>Because we will develop a TinyML project, we chose the latest version of the <code>Seeed nRF52 mbed-enabled Boards</code> package. Install it and wait until you see a successful installation prompt in the output window.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2023/jpeg/2392200/1685685860046-a9e57617-0456-4934-bc68-9fa5bf949f5f.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_7.jpeg" class="img-fluid"></p>
<p>Now, you can access this device from your Arduino IDE by selecting the development board and serial port, as shown in the figure below.</p>
<!-- ![L17-‰ºÅ‰∏öÂæÆ‰ø°20230602-092816\@2x.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685669373078-d5441cc0-2d5b-4998-8666-6b883c8813d5.png#averageHue=%238ca280&clientId=u729ff438-6678-4&from=ui&id=ub23a38a7&originHeight=1568&originWidth=2476&originalType=binary&ratio=2&rotation=0&showTitle=false&size=693202&status=done&style=stroke&taskId=u9997ad84-bb39-41dc-83ea-a590e847817&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_8.png" class="img-fluid"></p>
<p>Your development board is now ready to run code on it. Let‚Äôs start with Blink - lighting up the LED. Note that the board does not have a regular LED like most Arduino boards. Instead, you will find an RGB LED that can be activated with ‚Äúreverse logic‚Äù (you should apply LOW to activate each of the three separate LEDs). Test your RGB LED with the following code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// initialize serial.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> <span class="op">(!</span>Serial<span class="op">);</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Serial Started"</span><span class="op">);</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Pins for the built-in RGB LEDs on the Arduino Nano 33 BLE Sense</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  pinMode<span class="op">(</span>LEDR<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  pinMode<span class="op">(</span>LEDG<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  pinMode<span class="op">(</span>LEDB<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Note: The RGB LEDs are ON when the pin is LOW and off when HIGH.</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  digitalWrite<span class="op">(</span>LEDR<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  digitalWrite<span class="op">(</span>LEDG<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  digitalWrite<span class="op">(</span>LEDB<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  digitalWrite<span class="op">(</span>LEDR<span class="op">,</span> LOW<span class="op">);</span> </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"LED RED ON"</span><span class="op">);</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span>              </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  digitalWrite<span class="op">(</span>LEDR<span class="op">,</span> HIGH<span class="op">);</span>    </span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"LED RED OFF"</span><span class="op">);</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span>     </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  digitalWrite<span class="op">(</span>LEDG<span class="op">,</span> LOW<span class="op">);</span> </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"LED GREEN ON"</span><span class="op">);</span> </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span>              </span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  digitalWrite<span class="op">(</span>LEDG<span class="op">,</span> HIGH<span class="op">);</span>  </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"LED GREEN OFF"</span><span class="op">);</span>  </span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span>  </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  digitalWrite<span class="op">(</span>LEDB<span class="op">,</span> LOW<span class="op">);</span> </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"LED BLUE ON"</span><span class="op">);</span>  </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span>     </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  digitalWrite<span class="op">(</span>LEDB<span class="op">,</span> HIGH<span class="op">);</span>   </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"LED BLUE OFF"</span><span class="op">);</span>   </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span>  </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>Get this code online üîó <br> <a href="https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense/tree/main/Seeed_Xiao_Sense_bilnk_RGB" class="uri">https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense/tree/main/Seeed_Xiao_Sense_bilnk_RGB</a></p>
</blockquote>
<p>Here is the result:</p>
<!-- ![L15-rgbblink.jpg](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1669881875471-2c32f745-2860-43f3-a81e-d624868b8426.jpeg#averageHue=%23aab3b4&clientId=u9d74cf2b-c0d4-4&from=ui&id=ubfb26eaf&originHeight=540&originWidth=1215&originalType=binary&ratio=1&rotation=0&showTitle=false&size=315766&status=done&style=stroke&taskId=u43effa5c-768c-446d-bbbb-bae4664dafe&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_9.jpg" class="img-fluid"></p>
</section>
<section id="testing-the-microphone" class="level3">
<h3 class="anchored" data-anchor-id="testing-the-microphone">4.2.3.2 Testing the Microphone</h3>
<p>The XIAO nRF52840 Sense has a <a href="https://files.seeedstudio.com/wiki/XIAO-BLE/mic-MSM261D3526H1CPM-ENG.pdf">PDM digital output MEMS microphone</a>. Run the below code for testing it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;PDM.h&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">// buffer to read samples into, each sample is 16-bits</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">short</span> sampleBuffer<span class="op">[</span><span class="dv">256</span><span class="op">];</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">// number of samples read</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">volatile</span> <span class="dt">int</span> samplesRead<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">9600</span><span class="op">);</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>Serial<span class="op">);</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// configure the data receive callback</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    PDM<span class="op">.</span>onReceive<span class="op">(</span>onPDMdata<span class="op">);</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// optionally set the gain, defaults to 20</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// PDM.setGain(30);</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// initialize PDM with:</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - one channel (mono mode)</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - a 16 kHz sample rate</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>PDM<span class="op">.</span>begin<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">16000</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Failed to start PDM!"</span><span class="op">);</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// wait for samples to be read</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>samplesRead<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// print samples to the serial monitor or plotter</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> samplesRead<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>            Serial<span class="op">.</span>println<span class="op">(</span>sampleBuffer<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>            <span class="co">// check if the sound value is higher than 500</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sampleBuffer<span class="op">[</span>i<span class="op">]&gt;=</span><span class="dv">500</span><span class="op">){</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                digitalWrite<span class="op">(</span>LEDR<span class="op">,</span>LOW<span class="op">);</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                digitalWrite<span class="op">(</span>LEDG<span class="op">,</span>HIGH<span class="op">);</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                digitalWrite<span class="op">(</span>LEDB<span class="op">,</span>HIGH<span class="op">);</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>            <span class="co">// check if the sound value is higher than 250 and lower than 500</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sampleBuffer<span class="op">[</span>i<span class="op">]&gt;=</span><span class="dv">250</span> <span class="op">&amp;&amp;</span> sampleBuffer<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;</span> <span class="dv">500</span><span class="op">){</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>                digitalWrite<span class="op">(</span>LEDB<span class="op">,</span>LOW<span class="op">);</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>                digitalWrite<span class="op">(</span>LEDR<span class="op">,</span>HIGH<span class="op">);</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>                digitalWrite<span class="op">(</span>LEDG<span class="op">,</span>HIGH<span class="op">);</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>            <span class="co">//check if the sound value is higher than 0 and lower than 250</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sampleBuffer<span class="op">[</span>i<span class="op">]&gt;=</span><span class="dv">0</span> <span class="op">&amp;&amp;</span> sampleBuffer<span class="op">[</span>i<span class="op">]</span> <span class="op">&lt;</span> <span class="dv">250</span><span class="op">){</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>                digitalWrite<span class="op">(</span>LEDG<span class="op">,</span>LOW<span class="op">);</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>                digitalWrite<span class="op">(</span>LEDR<span class="op">,</span>HIGH<span class="op">);</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>                digitalWrite<span class="op">(</span>LEDB<span class="op">,</span>HIGH<span class="op">);</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">// clear the read count</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        samplesRead <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> onPDMdata<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="co">// query the number of bytes available</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> bytesAvailable <span class="op">=</span> PDM<span class="op">.</span>available<span class="op">();</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">// read into the sample buffer</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    PDM<span class="op">.</span>read<span class="op">(</span>sampleBuffer<span class="op">,</span> bytesAvailable<span class="op">);</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 16-bit, 2 bytes per sample</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    samplesRead <span class="op">=</span> bytesAvailable <span class="op">/</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The above code will continuously capture data to its buffer, displaying it in the Serial Monitor and Plotter:</p>
<!-- ![L17-A2.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685670276037-7bcefe78-65ae-4064-b606-7f9f47e07d6a.png#averageHue=%23f6f9f8&clientId=uc7a3e49a-ca50-4&from=ui&id=u8e67f0c0&originHeight=1485&originWidth=2532&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=3299193&status=done&style=stroke&taskId=ua913a880-9a00-4ce0-a562-54a86745e9d&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_10.png" class="img-fluid"></p>
<p>Also, note that the RGB LED will be set up depending on the intensity of sound.</p>
<blockquote class="blockquote">
<p>The Micrphone will not be used on this project in particular, but it is good to have it tested if it is your first time using the XIAO nRF52840 Sense.</p>
</blockquote>
</section>
<section id="testing-the-imu" class="level3">
<h3 class="anchored" data-anchor-id="testing-the-imu">4.2.3.3 Testing the IMU</h3>
<p>Our tiny device also has integrated a 6-Axis IMU, the <a href="https://files.seeedstudio.com/wiki/XIAO-BLE/ST_LSM6DS3TR_Datasheet.pdf">LSM6DS3TR-C</a>, a system-in-package 3D digital accelerometer, and a 3D digital gyroscope. For testing, you should first install its library ‚Äò<a href="https://github.com/Seeed-Studio/Seeed_Arduino_LSM6DS3/">Seeed Arduino LSM6DS3</a>‚Äô.</p>
<p>Before programming the accelerometer with the Arduino IDE, you must add the necessary library for the sensor. Enter the library address üîó <a href="https://github.com/Seeed-Studio/Seeed_Arduino_LSM6DS3/" class="uri">https://github.com/Seeed-Studio/Seeed_Arduino_LSM6DS3/</a> in the browser address bar, go to the GitHub page, click <code>Code‚ÜíDownload ZIP</code> to download the resource pack <code>Seeed_Arduino_LSM6DS3-master.zip</code> to the local area, as shown below.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1669882744468-cd7bde80-125d-4545-a95e-a16f14ece8ba.png#averageHue=%2397ae72&clientId=u72c77c6d-698e-4&from=paste&height=922&id=Vs4pW&originHeight=1844&originWidth=2988&originalType=binary&ratio=1&rotation=0&showTitle=false&size=612047&status=done&style=stroke&taskId=ub1e45245-4213-4aa7-9185-db763841e38&title=&width=1494) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_11.png" class="img-fluid"></p>
<p>Add the resource pack <code>Seeed_Arduino_LSM6DS3-master.zip</code> downloaded in the previous step in the menu bar‚Äôs <code>Sketch‚ÜíInclude Library‚ÜíAdd .ZIP Library</code> until you see a prompt that the library has been loaded successfully.</p>
<section id="run-the-test-code-based-on-harvard-universitys-tinymlx---sensor-test" class="level4">
<h4 class="anchored" data-anchor-id="run-the-test-code-based-on-harvard-universitys-tinymlx---sensor-test"><strong>Run the test code based on Harvard University‚Äôs tinymlx - Sensor Test</strong></h4>
<p>Now, run the following test code based on Harvard University‚Äôs tinymlx - Sensor Test.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"LSM6DS3.h"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"Wire.h"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">//Create an instance of class LSM6DS3</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>LSM6DS3 xIMU<span class="op">(</span>I2C_MODE<span class="op">,</span> <span class="bn">0x6A</span><span class="op">);</span>    <span class="co">//I2C device address 0x6A</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> c<span class="op">;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sign <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> <span class="op">(!</span>Serial<span class="op">);</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// configure the IMU</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>xIMU<span class="op">.</span>begin<span class="op">()</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Device error"</span><span class="op">);</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Device OK!"</span><span class="op">);</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Welcome to the IMU test for the built-in IMU on the XIAO BLE Sense</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Available commands:"</span><span class="op">);</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"a - display accelerometer readings in g's in x, y, and z directions"</span><span class="op">);</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"g - display gyroscope readings in deg/s in x, y, and z directions"</span><span class="op">);</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"t - display temperature readings in oC and oF"</span><span class="op">);</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Read incoming commands from serial monitor</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>Serial<span class="op">.</span>available<span class="op">())</span> <span class="op">{</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    c <span class="op">=</span> Serial<span class="op">.</span>read<span class="op">();</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    Serial<span class="op">.</span>println<span class="op">(</span>c<span class="op">);</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span><span class="op">(</span>c <span class="op">==</span> <span class="ch">'a'</span><span class="op">)</span>sign<span class="op">=</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>c <span class="op">==</span> <span class="ch">'g'</span><span class="op">)</span>sign<span class="op">=</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>c <span class="op">==</span> <span class="ch">'t'</span><span class="op">)</span>sign<span class="op">=</span><span class="dv">3</span><span class="op">;</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="dt">float</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>sign <span class="op">==</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span> <span class="co">// testing accelerometer</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>      <span class="co">//Accelerometer</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> xIMU<span class="op">.</span>readFloatAccelX<span class="op">();</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> xIMU<span class="op">.</span>readFloatAccelY<span class="op">();</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>      z <span class="op">=</span> xIMU<span class="op">.</span>readFloatAccelZ<span class="op">();</span>      </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Accelerometer:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">"Ax:"</span><span class="op">);</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="ch">' '</span><span class="op">);</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">"Ay:"</span><span class="op">);</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span>y<span class="op">);</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="ch">' '</span><span class="op">);</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">"Az:"</span><span class="op">);</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>println<span class="op">(</span>z<span class="op">);</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sign <span class="op">==</span><span class="dv">2</span><span class="op">)</span> <span class="op">{</span> <span class="co">// testing gyroscope</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>      <span class="co">//Gyroscope</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Gyroscope:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>      x <span class="op">=</span> xIMU<span class="op">.</span>readFloatGyroX<span class="op">();</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>      y <span class="op">=</span> xIMU<span class="op">.</span>readFloatGyroY<span class="op">();</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>      z <span class="op">=</span> xIMU<span class="op">.</span>readFloatGyroZ<span class="op">();</span>      </span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">"wx:"</span><span class="op">);</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="ch">' '</span><span class="op">);</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">"wy:"</span><span class="op">);</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span>y<span class="op">);</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="ch">' '</span><span class="op">);</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">"wz:"</span><span class="op">);</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>println<span class="op">(</span>z<span class="op">);</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>sign <span class="op">==</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span> <span class="co">// testing thermometer</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>       <span class="co">//Thermometer</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">Thermometer:</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">" Degrees oC = "</span><span class="op">);</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>println<span class="op">(</span>xIMU<span class="op">.</span>readTempC<span class="op">(),</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">" Degrees oF = "</span><span class="op">);</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>      Serial<span class="op">.</span>println<span class="op">(</span>xIMU<span class="op">.</span>readTempF<span class="op">(),</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>      delay<span class="op">(</span><span class="dv">1000</span><span class="op">);</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>Get this code online üîó <br> <a href="https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense/blob/main/xiao_test_IMU/xiao_test_IMU.ino" class="uri">https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense/blob/main/xiao_test_IMU/xiao_test_IMU.ino</a></p>
</blockquote>
<p>Once you run the above sketch, open the Serial Monitor:</p>
<!-- ![L17-A3.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685674760199-fcc2ec38-c5c8-455d-9c82-62ddc755f20f.png#averageHue=%23e7eae7&clientId=uc7a3e49a-ca50-4&from=ui&id=uf5b27123&originHeight=1488&originWidth=2532&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=2256272&status=done&style=stroke&taskId=u7bd622f3-0388-4cf4-906f-c4f100db124&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_12.png" class="img-fluid"></p>
<p>Choose one of the three options to test:</p>
<ul>
<li><strong>a</strong>: Accelerometer (see the result on Plotter)</li>
<li><strong>g</strong>: Gyroscope (see the result on Plotter)</li>
<li><strong>t</strong>: Temperature (see the result on Serial Monitor)</li>
</ul>
<p>The following images show the result:</p>
<!-- ![L17-A4.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685675264752-96e55676-8953-40a0-b1a3-5dbf1cc2cd1a.png#averageHue=%23e8f1e8&clientId=uc7a3e49a-ca50-4&from=ui&id=u05c9d6eb&originHeight=1326&originWidth=2256&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=2776340&status=done&style=stroke&taskId=ue3ffd0af-21aa-48ac-86a4-9d41fc132b5&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_13.png" class="img-fluid"></p>
<!-- ![L17-A5.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685675277457-da381ee4-f2af-465b-999a-52a51bee9d32.png#averageHue=%23f3f7f4&clientId=uc7a3e49a-ca50-4&from=ui&id=u5c647c32&originHeight=1323&originWidth=2256&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=2649215&status=done&style=stroke&taskId=u09c052e3-d4fc-4a4c-be87-13f6349a844&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_14.png" class="img-fluid"></p>
<!-- ![L17-A6.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685675290837-400ec846-36a6-44d4-8795-b9a9cfa466f4.png#averageHue=%23f0f2ef&clientId=uc7a3e49a-ca50-4&from=ui&id=uae04aa1b&originHeight=1326&originWidth=2256&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=2559221&status=done&style=stroke&taskId=uc9239d7b-018d-411e-99a0-703e9279d9b&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_15.png" class="img-fluid"></p>
</section>
</section>
</section>
<section id="the-tinyml-motion-classification-model" class="level2">
<h2 class="anchored" data-anchor-id="the-tinyml-motion-classification-model">4.2.4 The TinyML Motion Classification Model</h2>
<p>For our project, we will simulate mechanical stresses in transport. Our problem will be to classify four classes of movement:</p>
<ul>
<li><strong>Maritime</strong> (pallets in boats)</li>
<li><strong>Terrestrial</strong> (palettes in a Truck or Train)</li>
<li><strong>Lift</strong> (Palettes being handled by Fork-Lift)</li>
<li><strong>Idle</strong> (Palettes in Storage houses)</li>
</ul>
<!-- ![L17-a1.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685685932532-0d793d94-1fab-4f5b-9973-bef16d336345.png#averageHue=%23edf0ee&clientId=u038c5b2f-1490-4&from=ui&id=u7189fe52&originHeight=1020&originWidth=1920&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=1943471&status=done&style=stroke&taskId=u8e7c52e1-9882-487d-90e0-2fe2a69784d&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_16.png" class="img-fluid"></p>
<p>So, to start, we should collect data. Then, accelerometers will provide the data on the palette (or container).</p>
<!-- ![L17-a2.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685685985710-08fb2dc7-ee7b-4ed4-b4dd-d3cd7e3caa98.png#averageHue=%23e5e8e6&clientId=u038c5b2f-1490-4&from=ui&id=u238d82be&originHeight=1044&originWidth=1920&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=1925686&status=done&style=stroke&taskId=u0ed48981-1c8a-4b50-a723-3dbf011cfc6&title=)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_17.png" class="img-fluid"></p>
<!-- ![L17-a3-data3_cjs9H0JLQs.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685686008994-915c02c4-40fe-4df7-97c3-a7672badd516.png#averageHue=%23a7afae&clientId=u038c5b2f-1490-4&from=ui&id=u2118a7e7&originHeight=988&originWidth=1920&originalType=binary&ratio=2.5&rotation=0&showTitle=false&size=2586939&status=done&style=stroke&taskId=ua2558bb1-96da-4a6c-a881-03ea8517731&title=)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_18.png" class="img-fluid"></p>
<p>From the above images, we can see that primarily horizontal movements should be associated with ‚ÄúTerrestrial class,‚Äù Vertical movements to ‚ÄúLift Class,‚Äù no activity to ‚ÄúIdle class,‚Äù and movent on all three axes to <a href="https://www.containerhandbuch.de/chb_e/stra/index.html?/chb_e/stra/stra_02_03_03.htm">Maritime class</a>.</p>
<section id="connecting-a-device-to-the-edge-impulse-studio" class="level3">
<h3 class="anchored" data-anchor-id="connecting-a-device-to-the-edge-impulse-studio">4.2.4.1 Connecting a Device to the Edge Impulse Studio</h3>
<p>For data collection, we can have several options. In a real case, we can have our device, for example, connected directly to one container, and the data collected on a file (for example .CSV) and stored on an SD card (via SPI connection) or an offline repo in your computer. Data can also be sent remotely to a nearby repository, such as a mobile phone, using Bluetooth as done in this project: <a href="https://www.hackster.io/mjrobot/sensor-datalogger-50e44d">Sensor DataLogger</a>. Once your dataset is collected and stored as a .CSV file, it can be uploaded to the Studio using the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/data-acquisition/csv-wizard">CSV Wizard tool</a>.</p>
<blockquote class="blockquote">
<p>In this <a href="https://youtu.be/2KBPq_826WM">video</a>, you can learn alternative ways to send data to the Edge Impulse Studio.</p>
</blockquote>
<p>In this project, we should first connect our device to the Edge Impulse Studio for data collection, which will also be used for data pre-processing, model training, testing, and deployment.</p>
<blockquote class="blockquote">
<p>Follow the instructions <a href="https://docs.edgeimpulse.com/docs/edge-impulse-cli/cli-installation">here</a> to install the <a href="https://nodejs.org/en/">Node.js</a> and Edge Impulse CLI on your computer.</p>
</blockquote>
<p>Once the XIAO nRF52840 Sense is not a fully supported development board by Edge Impulse, we should use the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-cli/cli-data-forwarder">CLI Data Forwarder</a> to capture data from the accelerometer and send it to the Studio, as shown in this diagram:</p>
<!-- ![L17-image_PHK0GELEYh.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685686519311-2773d934-32bc-414e-819d-6eb1b229e52c.png#averageHue=%23e9ece1&clientId=ub5d6cce2-8f0f-4&from=ui&id=u97bf9406&originHeight=1620&originWidth=1710&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2378395&status=done&style=stroke&taskId=uc5cf36db-ed56-49ab-862d-970f8bdefd7&title=)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_19.png" class="img-fluid"></p>
<p>Your device should be connected to the computer serial and running a code to capture IMU (Accelerometer) data and ‚Äúprint them‚Äù on the serial. Further, the Edge Impulse Studio will ‚Äúcapture‚Äù them. Run the code below:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"LSM6DS3.h"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"Wire.h"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">//Create an instance of class LSM6DS3</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>LSM6DS3 xIMU<span class="op">(</span>I2C_MODE<span class="op">,</span> <span class="bn">0x6A</span><span class="op">);</span>    <span class="co">//I2C device address 0x6A</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CONVERT_G_TO_MS2    </span><span class="fl">9.80665</span><span class="bu">f</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define FREQUENCY_HZ        </span><span class="dv">50</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define INTERVAL_MS         </span><span class="op">(</span><span class="dv">1000</span><span class="pp"> </span><span class="op">/</span><span class="pp"> </span><span class="op">(</span>FREQUENCY_HZ<span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">1</span><span class="op">))</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="at">static</span> <span class="dt">unsigned</span> <span class="dt">long</span> last_interval_ms <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">115200</span><span class="op">);</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>Serial<span class="op">);</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// configure the IMU</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>xIMU<span class="op">.</span>begin<span class="op">()</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Device error"</span><span class="op">);</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Device OK!"</span><span class="op">);</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    Serial<span class="op">.</span>println<span class="op">(</span><span class="st">"Data Forwarder - Built-in IMU (Accelerometer) on the XIAO BLE Sense</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>millis<span class="op">()</span> <span class="op">&gt;</span> last_interval_ms <span class="op">+</span> INTERVAL_MS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>        last_interval_ms <span class="op">=</span> millis<span class="op">();</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> xIMU<span class="op">.</span>readFloatAccelX<span class="op">();</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> xIMU<span class="op">.</span>readFloatAccelY<span class="op">();</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> xIMU<span class="op">.</span>readFloatAccelZ<span class="op">();</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span>x <span class="op">*</span> CONVERT_G_TO_MS2<span class="op">);</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="ch">'</span><span class="sc">\t</span><span class="ch">'</span><span class="op">);</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span>y <span class="op">*</span> CONVERT_G_TO_MS2<span class="op">);</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>print<span class="op">(</span><span class="ch">'</span><span class="sc">\t</span><span class="ch">'</span><span class="op">);</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>        Serial<span class="op">.</span>println<span class="op">(</span>z <span class="op">*</span> CONVERT_G_TO_MS2<span class="op">);</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>Get this code online üîó <br> <a href="https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense/blob/main/XIAO_BLE_Sense_Accelerometer_Data_Forewarder/XIAO_BLE_Sense_Accelerometer_Data_Forewarder.ino" class="uri">https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense/blob/main/XIAO_BLE_Sense_Accelerometer_Data_Forewarder/XIAO_BLE_Sense_Accelerometer_Data_Forewarder.ino</a></p>
</blockquote>
<p>Go to the Edge Impulse page and create a project. Next, start the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-cli/cli-data-forwarder">CLI Data Forwarder</a> on your terminal, entering (if it is the first time) the following command:</p>
<!-- the command below is not cpp, is shell  -->
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="er">$</span> edge<span class="op">-</span>impulse<span class="op">-</span>data<span class="op">-</span>forwarder <span class="op">--</span>clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Next, enter your EI credentials, and choose your project, variable, and device names:</p>
<!-- ![pasted_graphic_13_CklDujzQho-X3.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670381198672-c3ae89aa-b29d-4ea2-a243-8b71c73f2ade.png#averageHue=%232d7e40&clientId=ub45caf77-7cac-4&from=ui&id=ue0fc8af3&originHeight=1323&originWidth=3348&originalType=binary&ratio=1&rotation=0&showTitle=false&size=2412654&status=done&style=stroke&taskId=u00f67c11-faa0-4901-8458-9d9d25cc170&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_20.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>The Studio can read the sampled frequency as 51Hz instead of the 50Hz previously defined in the code. It is OK.</p>
</blockquote>
<p>Go to the <code>Devices</code> section on your EI Project and verify if the device is connected (the dot should be green):</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670392173492-a76af287-550c-4e4e-ac1e-4dfe612d3124.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_21.jpeg" class="img-fluid"></p>
</section>
<section id="data-collection" class="level3">
<h3 class="anchored" data-anchor-id="data-collection">4.2.4.2 Data Collection</h3>
<p>As discussed before, we should capture data from all four Transportation Classes:</p>
<ul>
<li><strong>lift</strong> (up-down)</li>
<li><strong>terrestrial</strong> (left-right)</li>
<li><strong>maritime</strong> (zig-zag, etc.)</li>
<li><strong>idle</strong></li>
</ul>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1669886164444-232641c4-ed37-446a-ab43-27be0fbf03b0.png#averageHue=%23194c51&clientId=u72c77c6d-698e-4&from=paste&id=u769a6ccd&originHeight=555&originWidth=738&originalType=url&ratio=1&rotation=0&showTitle=false&size=486750&status=done&style=stroke&taskId=ue2c3adaa-4b3f-47a8-adfd-44146e8c688&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_22.png" class="img-fluid"></p>
<p>Below is one sample (10 seconds of raw data):</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1669886164950-5cab7b51-60db-46d2-afc5-a94bb9fee37e.png#averageHue=%231b2551&clientId=u72c77c6d-698e-4&from=paste&id=u6caa7ae0&originHeight=386&originWidth=648&originalType=url&ratio=1&rotation=0&showTitle=false&size=123522&status=done&style=stroke&taskId=u627d5acd-467b-44b4-bb86-fe395ba4e4f&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_23.png" class="img-fluid"></p>
<p>You can capture, for example, around 2 minutes (twelve samples of 10 seconds) for each of the four classes (a total of 8 minutes of data). Using the <code>three dots</code> menu after each one of the samples, select 2 of them, reserving them for the Test set. Alternatively, you can use the automatic <code>Train/Test Split tool</code> on the <code>Danger Zone</code> of <code>Dashboard</code> tab.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1669965981448-6be8c497-c763-4ea5-b2da-42a18562e088.png#averageHue=%23e1d868&clientId=ub9a1075e-6942-4&from=paste&height=809&id=uba0e9ac6&originHeight=1618&originWidth=2980&originalType=binary&ratio=1&rotation=0&showTitle=false&size=610988&status=done&style=stroke&taskId=u83b2b23b-9588-4f62-b6b9-a265a1613b1&title=&width=1490) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_24.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Once you have captured your dataset, you can explore it in more detail using the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/data-acquisition/data-explorer">Data Explorer</a>, a visual tool to find outliers or mislabeled data (helping to correct them). The data explorer first tries to extract meaningful features from your data (by applying signal processing and neural network embeddings) and then uses a dimensionality reduction algorithm such as <a href="https://en.wikipedia.org/wiki/Principal_component_analysis">PCA</a> or <a href="https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding">t-SNE</a> to map these features to a 2D space. This gives you a one-look overview of your complete dataset.</p>
</blockquote>
</section>
<section id="data-pre-processing" class="level3">
<h3 class="anchored" data-anchor-id="data-pre-processing">4.2.4.3 Data Pre-Processing</h3>
<p>Data pre-processing is extracting features from the dataset captured with the accelerometer, which involves processing and analyzing the raw data. Accelerometers measure the acceleration of an object along one or more axes (typically three, denoted as X, Y, and Z). These measurements can be used to understand various aspects of the object‚Äôs motion, such as movement patterns and vibrations.</p>
<p>Raw accelerometer data can be noisy and contain errors or irrelevant information. Preprocessing steps, such as filtering and normalization, can clean and standardize the data, making it more suitable for feature extraction. In our case, we should divide the data into smaller segments or <strong>windows</strong>. This can help focus on specific events or activities within the dataset, making feature extraction more manageable and meaningful. The <strong>window size</strong> and overlap (<strong>window increase</strong>) choice depend on the application and the frequency of the events of interest. As a thumb rule, we should try to capture a couple of ‚Äúcycles of data‚Äù.</p>
<blockquote class="blockquote">
<p>With a sampling rate (SR) of 50Hz and a window size of 2 seconds, we will get 100 samples per axis, or 300 in total (3 axis x 2 seconds x 50 samples). We will slide this window every 200ms, creating a larger dataset where each instance has 300 raw features.</p>
</blockquote>
<p><img src="imgs_4-2/pre-processing.jpg" class="img-fluid"></p>
<p>Once the data is preprocessed and segmented, you can extract features that describe the motion‚Äôs characteristics. Some typical features extracted from accelerometer data include: - <strong>Time-domain</strong> features describe the data‚Äôs statistical properties within each segment, such as mean, median, standard deviation, skewness, kurtosis, and zero-crossing rate. - <strong>Frequency-domain</strong> features are obtained by transforming the data into the frequency domain using techniques like the Fast Fourier Transform (FFT). Some typical frequency-domain features include the power spectrum, spectral energy, dominant frequencies (amplitude and frequency), and spectral entropy. - <strong>Time-frequency</strong> domain features combine the time and frequency domain information, such as the Short-Time Fourier Transform (STFT) or the Discrete Wavelet Transform (DWT). They can provide a more detailed understanding of how the signal‚Äôs frequency content changes over time.</p>
<p>In many cases, the number of extracted features can be large, which may lead to overfitting or increased computational complexity. Feature selection techniques, such as mutual information, correlation-based methods, or principal component analysis (PCA), can help identify the most relevant features for a given application and reduce the dimensionality of the dataset. The Studio can help with such feature importance calculations.</p>
<p><strong>EI Studio Spectral Features</strong></p>
<p>Data preprocessing is a challenging area for embedded machine learning. Still, Edge Impulse helps overcome this with its digital signal processing (DSP) preprocessing step and, more specifically, the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/processing-blocks/spectral-features">Spectral Features Block</a>.</p>
<p>On the Studio, the collected raw dataset will be the input of a Spectral Analysis block, which is excellent for analyzing repetitive motion, such as data from accelerometers. This block will perform a DSP (Digital Signal Processing), extracting features such as <a href="https://en.wikipedia.org/wiki/Fast_Fourier_transform">FFT</a> or <a href="https://en.wikipedia.org/wiki/Digital_signal_processing#Wavelet">Wavelets</a>.</p>
<p>For our project, once the time signal is continuous, we should use FFT with, for example, a length of <code>[32]</code>.</p>
<p>The per axis/channel <strong>Time Domain Statistical features</strong> are:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Root_mean_square">RMS</a>: 1 feature</li>
<li><a href="https://colab.research.google.com/corgiredirector?site=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSkewness">Skewness</a>: 1 feature</li>
<li><a href="https://colab.research.google.com/corgiredirector?site=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FKurtosis">Kurtosis</a>: 1 feature</li>
</ul>
<p>The per axis/channel <strong>Frequency Domain Spectral features</strong> are:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Spectral_density">Spectral Power</a>: 16 features (FFT Length/2)</li>
<li>Skewness: 1 feature</li>
<li>Kurtosis: 1 feature</li>
</ul>
<p>So, for an FFT length of 32 points, the resulting output of the Spectral Analysis Block will be 21 features per axis (a total of 63 features).</p>
<blockquote class="blockquote">
<p>You can learn more about how each feature is calculated by downloading the notebook <a href="https://github.com/Mjrovai/Arduino_Nicla_Vision/blob/main/Motion_Classification/Edge_Impulse_Spectral_Features_Block.ipynb">Edge Impulse - Spectral Features Block Analysis</a> <a href="https://www.hackster.io/mjrobot/tinyml-under-the-hood-spectral-analysis-94676c">TinyML under the hood: Spectral Analysis</a> or <a href="https://colab.research.google.com/github/Mjrovai/Arduino_Nicla_Vision/blob/main/Motion_Classification/Edge_Impulse_Spectral_Features_Block.ipynb">opening it directly on Google CoLab</a>.</p>
</blockquote>
<p>Those 63 features will be the Input Tensor of a Neural Network Classifier.</p>
</section>
<section id="model-design" class="level3">
<h3 class="anchored" data-anchor-id="model-design">4.2.4.4 Model Design</h3>
<p>Our classifier will be a Dense Neural Network (DNN) that will have 63 neurons on its input layer, two hidden layers with 20 and 10 neurons, and an output layer with four neurons (one per each class), as shown here:</p>
<p><img src="imgs_4-2/model-dnn.jpg" class="img-fluid"></p>
</section>
<section id="impulse-design" class="level3">
<h3 class="anchored" data-anchor-id="impulse-design">4.2.4.5 Impulse Design</h3>
<p>A complete Impulse comprises three primary building blocks: the input block - which obtains the raw data, the processing block - which extracts features, and the learning block - which classifies the data. The following image shows the interface when the three building blocks still need to be added, and our machine-learning pipeline will be implemented by adding these three blocks.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670462163437-2af8025e-9160-46fd-8406-0dbdee3736b1.png#averageHue=%23e5f1f2&clientId=ucd98b67c-148f-4&from=paste&height=349&id=zM4yy&originHeight=698&originWidth=2942&originalType=binary&ratio=1&rotation=0&showTitle=false&size=335583&status=done&style=stroke&taskId=u37bfbbdd-782f-41c0-9cba-766d8a4e76c&title=&width=1471) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_25.png" class="img-fluid"></p>
<p>Impulse obtains raw data through the input block, uses the processing block to extract features, and then uses the learning block to classify new data. In our continuous action recognition, the added blocks include:</p>
<section id="adding-the-input-block-time-series-data" class="level4">
<h4 class="anchored" data-anchor-id="adding-the-input-block-time-series-data"><strong>1. Adding the input block: Time Series Data</strong></h4>
<p>Click the ‚Äú<strong>Add an Input Block</strong>‚Äù button and select <strong>Time Series Data</strong> in the pop-up window as shown below to match the sensor data type we collected.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670463704732-f0c7dbdc-a8ce-4fca-8567-38146eb7421b.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_26.jpeg" class="img-fluid"></p>
<p>As shown in the figure below, set the <strong>Window Size</strong> to <code>2000</code> ms (2 seconds), the <strong>Window Increase</strong> to <code>80</code> milliseconds, and the <strong>Frequency</strong> to <code>51</code> Hz based on the calculations we made in the data preprocessing section on the Time Series Data block that appears.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670463706801-62da9427-cf35-4df6-a985-45d065465014.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_27.jpeg" class="img-fluid"></p>
</section>
<section id="adding-the-processing-block-spectral-analysis" class="level4">
<h4 class="anchored" data-anchor-id="adding-the-processing-block-spectral-analysis"><strong>2. Adding the processing block: Spectral Analysis</strong></h4>
<p>Click the ‚Äú<strong>Add a Processing Block</strong>‚Äù button and select <strong>Spectral Analysis</strong> in the pop-up window as shown below to match our motion analysis task type.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670467154819-582ab75b-fab7-4194-b2d8-e17d205951f9.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_28.jpeg" class="img-fluid"></p>
<p>The effect after adding the processing block is shown in the figure below.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670467378869-6f86267c-eb1c-40bf-a54d-e3c2651942d6.png#averageHue=%237eccb4&clientId=ucd98b67c-148f-4&from=paste&height=537&id=G2JGq&originHeight=1074&originWidth=2534&originalType=binary&ratio=1&rotation=0&showTitle=false&size=517508&status=done&style=stroke&taskId=u74c24df6-c3f1-4cae-a4d4-ae9662a1d39&title=&width=1267) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_29.png" class="img-fluid"></p>
</section>
<section id="adding-the-learning-block-classification" class="level4">
<h4 class="anchored" data-anchor-id="adding-the-learning-block-classification"><strong>3. Adding the learning block: Classification</strong></h4>
<p>Click the ‚ÄúAdd Learning Block‚Äù button and select <strong>Classification</strong> in the pop-up window as shown below to match our motion analysis task type.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670468235606-a97a61e5-8ca6-4fb8-b61d-03c828ffc9bd.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_30.jpeg" class="img-fluid"></p>
<p>The interface of Impulse design after addition is shown in the figure below, and now the machine learning pipeline has been built.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2023/jpeg/2392200/1685689492358-2cc0ab9a-e1fe-4509-9a8f-4614d2186289.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_31.jpeg" class="img-fluid"></p>
<p>In addition, we can also use a second model - K-means, which can be used for anomaly detection. If we imagine that we can treat our known classes as clusters, then any sample that does not fit into it might be an anomaly (for example, a container falling into the sea when the ship is at sea).</p>
<p><img src="imgs_4-2/kmeans.jpg" class="img-fluid"></p>
<p>For this, we can use the same input tensor entering the NN classifier as the input to the K-means model:</p>
<p><img src="imgs_4-2/blocks.jpg" class="img-fluid"></p>
<p>Click the ‚ÄúAdd Learning Block‚Äù button again and select <strong>Anomaly Detection (K-means)</strong> in the pop-up window below.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670469508268-66748b99-710e-49ab-86af-171066e323a5.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_30.jpeg" class="img-fluid"></p>
<p>The final Impulse design is as shown in the figure below, click the <strong>Save Impulse</strong> button on the far right.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670469607847-75f492c7-3d56-42d6-abc0-15d43bc7bb73.png#averageHue=%23eaf3f5&clientId=ucd98b67c-148f-4&from=paste&height=748&id=FO8nG&originHeight=1496&originWidth=2524&originalType=binary&ratio=1&rotation=0&showTitle=false&size=921643&status=done&style=stroke&taskId=u712d7f46-16ab-4303-8ef7-067961a19a5&title=&width=1262) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_33.png" class="img-fluid"></p>
</section>
</section>
<section id="generating-features" class="level3">
<h3 class="anchored" data-anchor-id="generating-features">4.2.4.6 Generating features</h3>
<p>At this point in our project, we have defined the pre-processing method and the model designed. Now, it is time to have the job done. First, let‚Äôs take the raw data (time-series type) and convert it to tabular data. Go to the <code>Spectral Features</code> tab, select <code>Save Parameters</code>,</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670469950498-a723603a-9752-4156-a6fd-55e14ff4e4d9.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_34.jpeg" class="img-fluid"></p>
<p>and at the top menu, select <code>Generate Features</code> option and <code>Generate Features</code> button:</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670473327644-03e562d2-2615-426f-a6c7-b94a5576c0f8.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_35.jpeg" class="img-fluid"></p>
<p>Each 2-second window data will be converted into one data point of 63 features. The Feature Explorer will show those data in 2D using <a href="https://umap-learn.readthedocs.io/en/latest/">UMAP</a>.</p>
<blockquote class="blockquote">
<p>Uniform Manifold Approximation and Projection (UMAP) is a dimension reduction technique that can be used for visualisation similarly to t-SNE, but also for general non-linear dimension reduction.</p>
</blockquote>
<p>With the visualization, it is possible to verify that the classes present an excellent separation, which indicates that the classifier should work well.</p>
<blockquote class="blockquote">
<p>Optionally you can analyze how important each one of the features is for one class compared with other classes.</p>
</blockquote>
</section>
<section id="training" class="level3">
<h3 class="anchored" data-anchor-id="training">4.2.4.7 Training</h3>
<p>Our model has four layers, as shown below:</p>
<p><img src="imgs_4-2/model.jpg" class="img-fluid"></p>
<p>As hyperparameters, we will use a Learning Rate of 0.005 and 20% of data for validation for 30 epochs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="imgs_4-2/train-hyper.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">image.png</figcaption>
</figure>
</div>
<p>After training, we can see that the accuracy is 100%.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="imgs_4-2/train-result.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">image.png</figcaption>
</figure>
</div>
<p>If a K-means block for anomaly detection has been added during model design, an additional section for <code>Anomaly Detection</code> will appear under the <code>Impulse Design</code> column on the left, as shown in the image below. Once inside the Anomaly Detection section, click <code>[Select Suggested Axes]</code>, and the system will automatically make selections based on previously calculated important features. Then click on the <code>[Start Training]</code> button to begin the training. Results will be output in the Anomaly Explorer on the right after completion.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670473262571-3972f45b-9dfe-475d-a51c-9cd0570b07d9.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_36.jpeg" class="img-fluid"></p>
<p>At this point, we have completed the basic machine learning training process.</p>
</section>
<section id="testing" class="level3">
<h3 class="anchored" data-anchor-id="testing">4.2.4.8 Testing</h3>
<p>Using the 20% of data set aside during the data collection phase, we can verify the model‚Äôs performance with unknown data. As shown in the image below, click on the <code>Model Testing</code> section on the left side of the Edge Impulse interface. Next to the <code>[Classify All]</code> button, there is an icon with three dots, click on it to open the <strong>Set Confidence Thresholds</strong> popup window. Here, you can set confidence thresholds for the results of the two learning blocks. We should define an acceptable threshold for results considered as anomalies. If a result is not 100% (which is often the case) but is within the threshold range, it is still usable.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670480041023-c796797c-ca90-464c-9aac-a1ee77c2b2ce.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_37.jpeg" class="img-fluid"></p>
<p>Press the <strong><code>Classify All</code></strong> button to start the model testing. The model test results will be displayed upon completion, as shown in the image below.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670479684301-22bda839-8c3d-4781-bbd0-6dce7720cb16.png#averageHue=%237eb04e&clientId=ucd98b67c-148f-4&from=paste&height=934&id=Unsmx&originHeight=1868&originWidth=2992&originalType=binary&ratio=1&rotation=0&showTitle=false&size=584226&status=done&style=stroke&taskId=uc8a134aa-f47a-44dc-af24-0fa07453791&title=&width=1496) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_38.png" class="img-fluid"></p>
</section>
<section id="live-classification" class="level3">
<h3 class="anchored" data-anchor-id="live-classification">4.2.4.9 Live Classification</h3>
<p>Once the model is obtained, you should use the opportunity to test the Live Classification when your device is still connected to the Edge Impulse Studio. As shown in the image below, click on the <strong><code>Live Classification</code></strong> section on the left side of the Edge Impulse interface, then click the <strong><code>[Start Sampling]</code></strong> button.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670481474542-c35895a9-c59d-418f-b79a-b10051845419.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_39.jpeg" class="img-fluid"></p>
<p>At this time, you can, for example, shake the XIAO, the process is the same as the sampling; wait a few seconds, and the classification results will be given. As shown in the image below, I shook the XIAO vigorously, and the model unhesitatingly inferred that the entire process was <strong>anomalous</strong>.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670482017791-df369a39-90e6-4146-8a3d-e4d94c757899.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_40.jpeg" class="img-fluid"></p>
<p>Try now with the same movements used during data capture. The result should match the class used for training.</p>
<blockquote class="blockquote">
<p>‚ö†Ô∏è Note: Here, you will capture real data with your device and upload it to the Edge Impulse Studio, where the trained model will be used for inference (though the model is not in your device).</p>
</blockquote>
</section>
<section id="deployment" class="level3">
<h3 class="anchored" data-anchor-id="deployment">4.2.4.10 Deployment</h3>
<p>Now it is time for magicÀú! The Studio will package all the needed libraries, preprocessing functions, and trained models, downloading them to your computer. You should select the option Arduino Library and at the bottom, select <code>Quantized (Int8)</code> and <code>Build</code>.</p>
<p><img src="imgs_4-2/deploy.jpg" class="img-fluid"></p>
<p>A Zip file will be created and downloaded to your computer.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670483560867-e96d4d5b-a1a0-440d-bda1-3c950b090f7c.png#averageHue=%23fefefe&clientId=ucd98b67c-148f-4&from=paste&height=437&id=u13bd3b03&originHeight=874&originWidth=1768&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95609&status=done&style=stroke&taskId=u042e5d58-f650-4d72-b4c5-2229ccae30a&title=&width=884) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_41.png" class="img-fluid"></p>
<p>On your Arduino IDE, go to <code>Sketch</code> tab and select the option <code>Add .ZIP Library</code>.</p>
<!-- ![L17-‰ºÅ‰∏öÂæÆ‰ø°20230602-154602\@2x.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685692107316-a6dc7897-631a-4f69-8c19-5006e5e67216.png#averageHue=%2390c277&clientId=ub5d6cce2-8f0f-4&from=ui&id=u9f875294&originHeight=792&originWidth=1894&originalType=binary&ratio=2&rotation=0&showTitle=false&size=406334&status=done&style=stroke&taskId=u25983496-b79e-4e8c-8ec6-e8d986c3580&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_42.png" class="img-fluid"></p>
<p>and Choose the.zip file downloaded by the Studio:</p>
<!-- ![L17-image_mVLE7G5k2A.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685692322993-fcc16a72-c295-4e9f-975c-0b47b7c863b6.png#averageHue=%23eff3ef&clientId=ub5d6cce2-8f0f-4&from=ui&id=u38eb6db6&originHeight=1380&originWidth=1647&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1865063&status=done&style=stroke&taskId=uf14b668c-d68d-40c6-a5d1-2e6a38249a7&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_43.png" class="img-fluid"></p>
</section>
<section id="inference" class="level3">
<h3 class="anchored" data-anchor-id="inference">4.2.4.11 Inference</h3>
<p>Now, it is time for a real test. We will make inferences wholly disconnected from the Studio. Let‚Äôs change one of the code examples created when you deploy the Arduino Library.</p>
<p>In your Arduino IDE, go to <code>File/Examples</code> tab and look for your project, and on examples, select <code>nano_ble_sense_accelerometer</code>:</p>
<!-- ![L17-image_mbxNmt3Kvu.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685692555489-d2e63b34-fd25-4bd1-8dd9-11f07b406351.png#averageHue=%23c7cad9&clientId=ub5d6cce2-8f0f-4&from=ui&height=292&id=uc8eafd0b&originHeight=888&originWidth=927&originalType=binary&ratio=2&rotation=0&showTitle=false&size=1223642&status=done&style=stroke&taskId=u6c0f8474-deaf-4875-a6f7-ffac9b4b7f6&title=&width=305.00848388671875) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_44.png" width="400" height="auto"></p>
<p>Of course, the Arduino Nano BLE 33 differs from your board, the XIAO, but we can have the code working with only a few changes. For example, at the beginning of the code, you have the library related to Arduino Sense IMU:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Includes -------------------------------------------------------------- */</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;XIAO_BLE_Sense_-_Motion_Classification_inferencing.h&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Arduino_LSM9DS1.h&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Change the ‚Äúincludes‚Äù portion with the code related to the XIAO nRF52840 Sense IMU:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Includes -------------------------------------------------------------- */</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;XIAO_BLE_Sense_-_Motion_Classification_inferencing.h&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"LSM6DS3.h"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"Wire.h"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">//Create an instance of class LSM6DS3</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>LSM6DS3 xIMU<span class="op">(</span>I2C_MODE<span class="op">,</span> <span class="bn">0x6A</span><span class="op">);</span>    <span class="co">//I2C device address 0x6A</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>On the setup function, initiate the IMU using the name that you stated before:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>xIMU<span class="op">.</span>begin<span class="op">()</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    ei_printf<span class="op">(</span><span class="st">"Failed to initialize IMU!</span><span class="sc">\r\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="op">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    ei_printf<span class="op">(</span><span class="st">"IMU initialized</span><span class="sc">\r\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At the loop function, the buffers: <code>buffer[ix], buffer[ix + 1]</code> and <code>buffer[ix + 2]</code> will receive the 3 axis data captured by the accelerometer. On the original code, you have the line:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>IMU<span class="op">.</span>readAcceleration<span class="op">(</span>buffer<span class="op">[</span>ix<span class="op">],</span> buffer<span class="op">[</span>ix <span class="op">+</span> <span class="dv">1</span><span class="op">],</span> buffer<span class="op">[</span>ix <span class="op">+</span> <span class="dv">2</span><span class="op">]);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Change it with this block of code:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>buffer<span class="op">[</span>ix<span class="op">]</span>     <span class="op">=</span> xIMU<span class="op">.</span>readFloatAccelX<span class="op">();</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>buffer<span class="op">[</span>ix <span class="op">+</span> <span class="dv">1</span><span class="op">]</span> <span class="op">=</span> xIMU<span class="op">.</span>readFloatAccelY<span class="op">();</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>buffer<span class="op">[</span>ix <span class="op">+</span> <span class="dv">2</span><span class="op">]</span> <span class="op">=</span> xIMU<span class="op">.</span>readFloatAccelZ<span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And that is it! You can now upload the code to your device and proceed with the inferences. &gt; You can find the complete code on the project GitHub</p>
<p>You can see the result of the inference of each class on the images:</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670488708472-dd862731-7b40-441c-982a-2bf355a5c919.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-2/chapter_4-2_45.jpeg" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Get this code online üîó <br> <a href="https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense/blob/main/XIAO_BLE_Sense_accelerometer/XIAO_BLE_Sense_accelerometer.ino" class="uri">https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense/blob/main/XIAO_BLE_Sense_accelerometer/XIAO_BLE_Sense_accelerometer.ino</a></p>
</blockquote>
</section>
<section id="post-processing" class="level3">
<h3 class="anchored" data-anchor-id="post-processing">Post-processing</h3>
<p>Now that we know the model is working since it detects the movements, we suggest that you modify the code to see the result with the XIAO completely offline (disconnected from the PC and powered by a battery, a power bank, or an independent 5V power supply).</p>
<p>The idea is that if one specific movement is detected, a particular LED could be lit. For example, if <em>terrestrial</em> is detected, the Green LED will light; if <em>maritime</em>, the Red LED will light, if it is a <em>lift,</em> the Blue LED will light; and if no movement is detected <em>(idle</em>), the LEDs will be OFF. You can also add a condition when an anomaly is detected, in this case, for example, a white color can be used (all e LEDs light simultaneously).</p>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">4.2.4.12 Conclusion</h3>
<p>The Seeed Studio XIAO nRF52840 Sense is a giant tiny device! It is powerful, trustworthy, not expensive, low power, and has suitable sensors to be used on the most common embedded machine learning applications. Even though Edge Impulse does not officially support XIAO nRF52840 Sense, we also realized that it could be easily connected with the Studio.</p>
<blockquote class="blockquote">
<p>On the GitHub repository, you will find the last version of the codes: <a href="https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense">Seeed-XIAO-BLE-Sense</a>.</p>
</blockquote>
<p>The applications for motion classification and anomaly detection are extensive, and the XIAO is well-suited for scenarios where low power consumption and edge processing are advantageous. Its small form factor and efficiency in processing make it an ideal choice for deploying portable and remote applications where real-time processing is crucial and connectivity may be limited.</p>
</section>
<section id="case-applications" class="level3">
<h3 class="anchored" data-anchor-id="case-applications">4.2.4.13 Case Applications</h3>
<p>Before we finish, consider that Movement Classification and Object Detection can be utilized in many applications across various domains. Here are some of the potential applications:</p>
<section id="industrial-and-manufacturing" class="level4">
<h4 class="anchored" data-anchor-id="industrial-and-manufacturing"><strong>Industrial and Manufacturing</strong></h4>
<ul>
<li><strong>Predictive Maintenance</strong>: Detecting anomalies in machinery motion to predict failures before they occur.</li>
<li><strong>Quality Control</strong>: Monitoring the motion of assembly lines or robotic arms for precision assessment and deviation detection from the standard motion pattern.</li>
<li><strong>Warehouse Logistics</strong>: Managing and tracking the movement of goods with automated systems that classify different types of motion and detect anomalies in handling.</li>
</ul>
</section>
<section id="healthcare" class="level4">
<h4 class="anchored" data-anchor-id="healthcare"><strong>Healthcare</strong></h4>
<ul>
<li><strong>Patient Monitoring</strong>: Detecting falls or abnormal movements in the elderly or those with mobility issues.</li>
<li><strong>Rehabilitation</strong>: Monitoring the progress of patients recovering from injuries by classifying motion patterns during physical therapy sessions.</li>
<li><strong>Activity Recognition</strong>: Classifying types of physical activity for fitness applications or patient monitoring.</li>
</ul>
</section>
<section id="consumer-electronics" class="level4">
<h4 class="anchored" data-anchor-id="consumer-electronics"><strong>Consumer Electronics</strong></h4>
<ul>
<li><strong>Gesture Control</strong>: Interpreting specific motions to control devices, such as turning on lights with a hand wave.</li>
<li><strong>Gaming</strong>: Enhancing gaming experiences with motion-controlled inputs.</li>
</ul>
</section>
<section id="transportation-and-logistics" class="level4">
<h4 class="anchored" data-anchor-id="transportation-and-logistics"><strong>Transportation and Logistics</strong></h4>
<ul>
<li><strong>Vehicle Telematics</strong>: Monitoring vehicle motion for unusual behavior such as hard braking, sharp turns, or accidents.</li>
<li><strong>Cargo Monitoring</strong>: Ensuring the integrity of goods during transport by detecting unusual movements that could indicate tampering or mishandling.</li>
</ul>
</section>
<section id="smart-cities-and-infrastructure" class="level4">
<h4 class="anchored" data-anchor-id="smart-cities-and-infrastructure"><strong>Smart Cities and Infrastructure</strong></h4>
<ul>
<li><strong>Structural Health Monitoring</strong>: Detecting vibrations or movements within structures that could indicate potential failures or maintenance needs.</li>
<li><strong>Traffic Management</strong>: Analyzing the flow of pedestrians or vehicles to improve urban mobility and safety.</li>
</ul>
</section>
<section id="security-and-surveillance" class="level4">
<h4 class="anchored" data-anchor-id="security-and-surveillance"><strong>Security and Surveillance</strong></h4>
<ul>
<li><strong>Intruder Detection</strong>: Detecting motion patterns typical of unauthorized access or other security breaches.</li>
<li><strong>Wildlife Monitoring</strong>: Detecting poachers or abnormal animal movements in protected areas.</li>
</ul>
</section>
<section id="agriculture" class="level4">
<h4 class="anchored" data-anchor-id="agriculture"><strong>Agriculture</strong></h4>
<ul>
<li><strong>Equipment Monitoring</strong>: Tracking the performance and usage of agricultural machinery.</li>
<li><strong>Animal Behavior Analysis</strong>: Monitoring livestock movements to detect behaviors indicating health issues or stress.</li>
</ul>
</section>
<section id="environmental-monitoring" class="level4">
<h4 class="anchored" data-anchor-id="environmental-monitoring"><strong>Environmental Monitoring</strong></h4>
<ul>
<li><strong>Seismic Activity</strong>: Detecting irregular motion patterns that precede earthquakes or other geologically relevant events.</li>
<li><strong>Oceanography</strong>: Studying wave patterns or marine movements for research and safety purposes.</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter_4-1.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">4.1 Understanding TinyML and Edge Impulse Studio</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter_4-3.html" class="pagination-link">
        <span class="nav-page-text">4.3 TinyML Made Easy: Sound Classification (KWS)</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">XIAO: Big Power, Small Board</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>