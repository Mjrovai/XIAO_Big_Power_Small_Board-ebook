<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>XIAO: Big Power, Small Board - 4.3 TinyML Made Easy: Sound Classification (KWS)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./chapter_4-4.html" rel="next">
<link href="./chapter_4-2.html" rel="prev">
<link href="./cover.jpg" rel="icon" type="image/jpeg">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">XIAO: Big Power, Small Board</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://github.com/Mjrovai/XIAO_Big_Power_Small_Board-ebook" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="./XIAO--Big-Power,-Small-Board.pdf">
              <i class="bi bi-bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="./XIAO--Big-Power,-Small-Board.epub">
              <i class="bi bi-bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools ms-auto-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./chapter_4.html">Chapter 4: Project Practice Advanced - TinyML Applications</a></li><li class="breadcrumb-item"><a href="./chapter_4-3.html">4.3 TinyML Made Easy: Sound Classification (KWS)</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about_book.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this Book</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 1: Introduction to Hardware and Programming</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.1 First Arduino program with Seeed Studio XIAO: Blink</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.2 Using the Button Switch on the XIAO Expansion Board to Control an LED Light</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.3 Transforming XIAO and its Expansion Board into a Morse Code Transmitter</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.4 Monitor Knob Value Changes with Serial Monitor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.5 Controlling LED and Servo with a Knob</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_1-6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1.6 Displaying “Hello World” on OLED</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 2: Project Practice for Beginners - Introduction to Prototype Design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.1 Introduction to Product Prototype Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.2 Smart Hygrometer and Thermometer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.3 Surprise Gift Box Based on Light Sensor</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_2-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2.4 Rhythmic Dance with a Triaxial Accelerometer</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 3: Intermediate Project Practice---Complex Projects</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.1 Smart Remote Control Door</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.2 Smart Watch</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.3 Air Piano</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.4 Implementing Wi-Fi Connection and Applications with XIAO ESP32C3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_3-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3.5 Telemetry and Commands using the MQTT protocol with XIAO ESP32C3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 4: Project Practice Advanced - TinyML Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.1 Understanding TinyML and Edge Impulse Studio</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.2 TinyML Made Easy: Anomaly Detection &amp; Motion Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">4.3 TinyML Made Easy: Sound Classification (KWS)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.4 TinyML Made Easy: Image Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_4-5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4.5 TinyML Made Easy: Object Detection</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./chapter_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chapter 5: Creative Experiments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter_5-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5.1 Creative and useful XIAO projects</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about_authors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the authors</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#things-used-in-this-project" id="toc-things-used-in-this-project" class="nav-link active" data-scroll-target="#things-used-in-this-project">4.3.1 Things used in this project</a>
  <ul class="collapse">
  <li><a href="#hardware-components" id="toc-hardware-components" class="nav-link" data-scroll-target="#hardware-components">Hardware components</a></li>
  <li><a href="#software-apps-and-online-services" id="toc-software-apps-and-online-services" class="nav-link" data-scroll-target="#software-apps-and-online-services">Software apps and online services</a></li>
  </ul></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">4.3.2 Introduction</a></li>
  <li><a href="#the-kws-project" id="toc-the-kws-project" class="nav-link" data-scroll-target="#the-kws-project">4.3.3 The KWS Project</a>
  <ul class="collapse">
  <li><a href="#the-machine-learning-workflow" id="toc-the-machine-learning-workflow" class="nav-link" data-scroll-target="#the-machine-learning-workflow">4.3.3.1 The Machine Learning Workflow</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">4.3.3.2 Dataset</a></li>
  <li><a href="#capturing-online-audio-data-with-edge-impulse-and-a-smartphone" id="toc-capturing-online-audio-data-with-edge-impulse-and-a-smartphone" class="nav-link" data-scroll-target="#capturing-online-audio-data-with-edge-impulse-and-a-smartphone">4.3.3.3 Capturing online Audio Data with Edge Impulse and a smartphone</a></li>
  <li><a href="#capturing-audio-data-with-the-xiao-nrf52840-sense" id="toc-capturing-audio-data-with-the-xiao-nrf52840-sense" class="nav-link" data-scroll-target="#capturing-audio-data-with-the-xiao-nrf52840-sense">4.3.3.4 Capturing Audio Data with the XIAO nRF52840 Sense</a></li>
  <li><a href="#capturing-offline-audio-data-with-a-smartphone-or-pc" id="toc-capturing-offline-audio-data-with-a-smartphone-or-pc" class="nav-link" data-scroll-target="#capturing-offline-audio-data-with-a-smartphone-or-pc">4.3.3.5 Capturing (offline) Audio Data with a smartphone or PC</a></li>
  <li><a href="#training-model-with-edge-impulse-studio" id="toc-training-model-with-edge-impulse-studio" class="nav-link" data-scroll-target="#training-model-with-edge-impulse-studio">4.3.3.6 Training model with Edge Impulse Studio</a></li>
  <li><a href="#creating-impulse-pre-process-model-definition" id="toc-creating-impulse-pre-process-model-definition" class="nav-link" data-scroll-target="#creating-impulse-pre-process-model-definition">4.3.3.7 Creating Impulse (Pre-Process / Model definition)</a></li>
  <li><a href="#pre-processing-mfcc" id="toc-pre-processing-mfcc" class="nav-link" data-scroll-target="#pre-processing-mfcc">4.3.3.8 Pre-Processing (MFCC)</a></li>
  <li><a href="#model-design-and-training" id="toc-model-design-and-training" class="nav-link" data-scroll-target="#model-design-and-training">4.3.3.9 Model Design and Training</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing">4.3.3.10 Testing</a></li>
  <li><a href="#deploy-and-inference" id="toc-deploy-and-inference" class="nav-link" data-scroll-target="#deploy-and-inference">4.3.3.11 Deploy and Inference</a></li>
  <li><a href="#postprocessing" id="toc-postprocessing" class="nav-link" data-scroll-target="#postprocessing">4.3.3.12 Postprocessing</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">4.3.3.13 Conclusion</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Mjrovai/XIAO_Big_Power_Small_Board-ebook/edit/main/chapter_4-3.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/Mjrovai/XIAO_Big_Power_Small_Board-ebook/issues/new" class="toc-action">Report an issue</a></p><p><a href="https://github.com/Mjrovai/XIAO_Big_Power_Small_Board-ebook/blob/main/chapter_4-3.qmd" class="toc-action">View source</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">4.3 TinyML Made Easy: Sound Classification (KWS)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670489386491-5f565da3-b045-473a-af15-1610d3fe0df7.png#averageHue=%235d918e&clientId=u0674af82-de24-4&from=paste&height=472&id=u45e9b289&originHeight=500&originWidth=666&originalType=binary&ratio=1&rotation=0&showTitle=false&size=444034&status=done&style=none&taskId=u9c2a33f1-28ec-4080-a923-67a555f4de1&title=&width=628.9971618652344) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_1.png" class="img-fluid"></p>
<p>We are continuing our exploration of Machine Learning on a giant tiny device, the Seeed Studio XIAO nRF52840 Sense（also called XIAO BLE Sense. And now, classifying sound waves.</p>
<section id="things-used-in-this-project" class="level2">
<h2 class="anchored" data-anchor-id="things-used-in-this-project">4.3.1 Things used in this project</h2>
<section id="hardware-components" class="level3">
<h3 class="anchored" data-anchor-id="hardware-components">Hardware components</h3>
<ul>
<li><a href="https://www.seeedstudio.com/Seeed-XIAO-BLE-Sense-nRF52840-p-5253.html">Seeed Studio XIAO nRF52840 Sense</a> × 1 <img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_2.png" width="400" height="auto"></li>
</ul>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1668492017246-6f04d198-1961-4f7b-a990-dd6937468025.png#averageHue=%23a6997f&clientId=u640cf75b-7515-4&from=paste&height=78&id=tGTo8&originHeight=650&originWidth=970&originalType=binary&ratio=1&rotation=0&showTitle=false&size=512355&status=done&style=none&taskId=u369408e4-7109-4379-8247-0698cf19286&title=&width=116) -->
<ul>
<li><a href="https://www.hackster.io/seeed/products/seeeduino-xiao-expansion-board?ref=project-2fb3ab">Seeed Studio Seeeduino XIAO Expansion board</a> × 1 <img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_3.png" width="400" height="auto"></li>
</ul>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670489721847-bce1ee9e-bdfe-4f3f-b34c-afaa846f95b5.png#averageHue=%23d5d0c2&clientId=u4cbf8898-7b24-4&from=paste&height=92&id=TtqSF&originHeight=450&originWidth=600&originalType=binary&ratio=1&rotation=0&showTitle=false&size=199731&status=done&style=none&taskId=u81ddb6bb-32a5-40a5-9248-5eb5ae6af92&title=&width=123) -->
</section>
<section id="software-apps-and-online-services" class="level3">
<h3 class="anchored" data-anchor-id="software-apps-and-online-services">Software apps and online services</h3>
<ul>
<li><a href="https://www.hackster.io/arduino/products/arduino-ide?ref=project-958fd2">Arduino IDE</a> <img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_4.png" class="img-fluid"></li>
</ul>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1669875695345-b20a52ba-5da7-4ce2-b21b-5ecb9b9802c3.png#averageHue=%23f3f4f1&clientId=u413b5b5e-84eb-4&from=paste&height=48&id=bESIK&originHeight=96&originWidth=96&originalType=binary&ratio=1&rotation=0&showTitle=false&size=9015&status=done&style=none&taskId=u32e545f3-6819-4f99-b7ea-98db56952d2&title=&width=48) -->
<ul>
<li><a href="https://www.hackster.io/EdgeImpulse/products/edge-impulse-studio?ref=project-958fd2">Edge Impulse Studio</a> <img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_5.png" class="img-fluid"></li>
</ul>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1669875769259-c9ab4bef-809a-4c6a-ad7a-aa9fb078eb9e.png#averageHue=%23cfe688&clientId=ud4d22600-5c37-4&from=paste&height=48&id=k6jic&originHeight=96&originWidth=96&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8524&status=done&style=none&taskId=uc8745d54-8c8b-4814-8de4-d9d8bbf9f31&title=&width=48)  -->
</section>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">4.3.2 Introduction</h2>
<p>In the last section, <strong>TinyML Made Easy: Anomaly Detection &amp; Motion Classification</strong>, we explored Embedded Machine Learning, or simply TinyML, running on the <a href="https://www.seeedstudio.com/Seeed-XIAO-BLE-Sense-nRF52840-p-5253.html">Seeed XIAO nRF52840 Sense.</a> Besides installing and testing the device, we explored motion classification using actual data signals from its onboard accelerometer. This new project will use the same XIAO nRF52840 Sense to classify sound, explicitly working as “Key Word Spotting” (KWS). A KWS is a typical TinyML application and an essential part of a voice assistant.</p>
<blockquote class="blockquote">
<p><strong>But how does a voice assistant work?</strong></p>
</blockquote>
<p>To start, it is essential to realize that Voice Assistants on the market, like Google Home or Amazon Echo-Dot, only react to humans when they are “waked up” by particular keywords such as ” Hey Google” on the first one and “Alexa” on the second.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2023/jpeg/2392200/1685693750936-1d2ebed6-c962-4f52-b256-cc4808feec38.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_6.jpeg" class="img-fluid"></p>
<p>In other words, recognizing voice commands is based on a multi-stage model or Cascade Detection. <img src="imgs_4-3/stages.jpg" class="img-fluid" alt="L18-image_Zd5vTdG9RB.png"></p>
<p><strong>Stage 1:</strong> A smaller microprocessor inside the <em>Echo Dot</em> or <em>Google Home</em> continuously listens to the sound, waiting for the keyword to be spotted. For such detection, a TinyML model at the edge is used (KWS application).</p>
<p><strong>Stage 2:</strong> Only when triggered by the KWS application on Stage 1 is the data sent to the cloud and processed on a larger model.</p>
<p>The video below shows an example of a Google Assistant being programmed on a Raspberry Pi (Stage 2), with an Arduino Nano 33 BLE as the tinyML device (Stage 1): https://youtu.be/e_OPgcnsyvM</p>
<blockquote class="blockquote">
<p>To explore the above Google Assistant project, please see the tutorial: <a href="https://www.hackster.io/mjrobot/building-an-intelligent-voice-assistant-from-scratch-2199c3">Building an Intelligent Voice Assistant From Scratch</a>.</p>
</blockquote>
</section>
<section id="the-kws-project" class="level2">
<h2 class="anchored" data-anchor-id="the-kws-project">4.3.3 The KWS Project</h2>
<!-- The diagram below will give an idea of how the final KWS application should work (during inference): ![L18-image_j6Hkf5YADI.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685694103808-97a66dbf-9b0e-4a2e-b6c1-24e8672fe4ad.png#averageHue=%23e1eee1&clientId=u35667e24-ee4e-4&from=ui&id=u49b43526&originHeight=1160&originWidth=2560&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=3096488&status=done&style=none&taskId=u97d564de-dd6b-408b-967a-82e3bc76589&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_7.png" class="img-fluid"></p>
<p>Our KWS application will recognize three classes of sound:</p>
<ul>
<li>Keyword 1: <strong>UNIFEI</strong></li>
<li>Keyword 2: <strong>IESTI</strong></li>
<li>“<strong>SILENCE</strong>” (no keywords spoken, only background noise is present)</li>
</ul>
<blockquote class="blockquote">
<p>Optionally, for real-world projects, it is advised to include different words than keywords 1 and 2 in the class “Silence” (or Background) or even create an extra class with such words (for example a class “others”).</p>
</blockquote>
<section id="the-machine-learning-workflow" class="level3">
<h3 class="anchored" data-anchor-id="the-machine-learning-workflow">4.3.3.1 The Machine Learning Workflow</h3>
<p>The main component of the KWS application is its model. So, we must train such a model with our specific keywords:</p>
<!-- ![L18-image_VjDpbeenv9.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685694470384-32af2579-6145-4963-9eaf-e21f512dea68.png#averageHue=%23dde5d9&clientId=u35667e24-ee4e-4&from=ui&id=ud089c6fd&originHeight=1575&originWidth=3840&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=5767304&status=done&style=none&taskId=u1cdfaec0-926a-45c3-8281-d5679524ccc&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_8.png" class="img-fluid"></p>
</section>
<section id="dataset" class="level3">
<h3 class="anchored" data-anchor-id="dataset">4.3.3.2 Dataset</h3>
<p>The critical component of Machine Learning Workflow is the dataset. Once we have decided on specific keywords (UNIFEI and IESTI), all datasets should be created from zero. When working with accelerometers, creating a dataset with data captured by the same type of sensor was essential. In the case of sound, it is different because of what we will classify as audio data.</p>
<blockquote class="blockquote">
<p>The critical difference between sound and audio is the type of energy. Sound is mechanical perturbation (longitudinal sound waves) that propagate through a medium, causing variations of pressure in it. Audio is an electrical (analog or digital) signal representing sound.</p>
</blockquote>
<p>The sound waves should be converted to audio data when we speak a keyword. The conversion should be done by sampling the signal generated by the microphone in 16KHz with a 16-bit depth.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="imgs_4-3/unifei.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">L18-image_RSir4IYkbj.png</figcaption>
</figure>
</div>
<p>So, any device that can generate audio data with this basic specification (16Khz/16bits) will work fine. As a device, we can use the proper XIAO nRF52840 Sense, a computer, or even your mobile phone.</p>
</section>
<section id="capturing-online-audio-data-with-edge-impulse-and-a-smartphone" class="level3">
<h3 class="anchored" data-anchor-id="capturing-online-audio-data-with-edge-impulse-and-a-smartphone">4.3.3.3 Capturing online Audio Data with Edge Impulse and a smartphone</h3>
<p>In the <em>TinyML Made Easy: Anomaly Detection &amp; Motion Classification</em> section, we learned how to install and test our device using the Arduino IDE and connect it to Edge Impulse Studio for data capturing. For that, we use the <em>EI CLI function Data Forwarder</em>, but according to Jan Jongboom, Edge Impulse CTO, audio goes too fast for the data forwarder to be captured. If you have PCM data already, then turning it into a WAV file and uploading it with the uploader is the easiest. With accelerometers, our sample frequency was around 50Hz, with audio being 16KHz.</p>
<p>So, we can not connect the XIAO directly to the Studio. But we can capture sound using any smartphone connected to the Studio online.</p>
<blockquote class="blockquote">
<p>We will not explore this option here, but you can easily follow the EI <a href="https://docs.edgeimpulse.com/docs/development-platforms/using-your-mobile-phone">documentation</a> and <a href="https://docs.edgeimpulse.com/docs/tutorials/responding-to-your-voice">tutorial</a>.</p>
</blockquote>
</section>
<section id="capturing-audio-data-with-the-xiao-nrf52840-sense" class="level3">
<h3 class="anchored" data-anchor-id="capturing-audio-data-with-the-xiao-nrf52840-sense">4.3.3.4 Capturing Audio Data with the XIAO nRF52840 Sense</h3>
<p>The easiest way to capture audio and save it locally as a .wav file is using an expansion board for the XIAO family of devices, the <a href="https://wiki.seeedstudio.com/Seeeduino-XIAO-Expansion-Board/">Seeed Studio XIAO Expansion board</a>.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670489850021-2dcd8493-ddf3-4fc0-ac78-ec11cc423f5e.png#averageHue=%23f4f5ee&clientId=u37ea6ca3-4802-4&from=paste&id=uc7652580&originHeight=555&originWidth=740&originalType=url&ratio=1&rotation=0&showTitle=false&size=273948&status=done&style=none&taskId=ub98ea55a-a982-44bc-b1d6-a02813f120a&title=) -->
<div style="text-align:center;">
<img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_3.png" width="500" height="auto" style="margin:0 auto">
</div>
<!-- ![L18-XIAO-Expansion-2.jpeg](https://cdn.nlark.com/yuque/0/2023/jpeg/2392200/1685694857338-ba3ec638-0295-4266-8aee-43e6660f1c55.jpeg#averageHue=%23d2d1d1&clientId=u35667e24-ee4e-4&from=ui&id=u50b0e775&originHeight=1667&originWidth=3334&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=498653&status=done&style=none&taskId=u08187048-68e2-4387-a861-c0ffcc09dbb&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_10.jpeg" class="img-fluid"></p>
<!-- ![L18-XIAO-Expansion-3.jpeg](https://cdn.nlark.com/yuque/0/2023/jpeg/2392200/1685694871959-56286a5b-a2d1-4227-8849-2005594a0756.jpeg#averageHue=%23d5d5d4&clientId=u35667e24-ee4e-4&from=ui&id=u00fc5acd&originHeight=1663&originWidth=3334&originalType=binary&ratio=2.200000047683716&rotation=0&showTitle=false&size=438418&status=done&style=none&taskId=u10446bde-ccac-4ad8-b5d5-ac9ac89ca36&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_11.jpeg" class="img-fluid"></p>
<p>This expansion board enables the building of prototypes and projects easily and quickly, using its rich peripherals such as OLED Display, SD Card interface, RTC, passive buzzer, RESET/User button, 5V servo connector, and multiple data interfaces.</p>
<p>This project will focus on classifying keywords, and the MicroSD card available on the device will be very important in helping us with data capture.</p>
<section id="saving-recorded-audio-from-the-microphone-on-an-sd-card" class="level4">
<h4 class="anchored" data-anchor-id="saving-recorded-audio-from-the-microphone-on-an-sd-card">Saving recorded audio from the microphone on an SD card</h4>
<p>Connect the XIAO nRF52840 Sense on the Expansion Board and insert an SD card into the SD card slot at the back. &gt; The SD Card should be pre-formated as FAT or exFAT.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2023/jpeg/2392200/1685695024054-f81c8a0a-4753-4092-86a9-8f4d0a1ba151.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_12.jpeg" class="img-fluid"></p>
<p>Next, download the <a href="https://github.com/Seeed-Studio/Seeed_Arduino_Mic">Seeed_Arduino_FS Library</a> as a zip file:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670550468338-07de9328-e76b-4d80-9a00-3118cc441387.png#averageHue=%23d6846e&clientId=ud2340ef8-d908-4&from=paste&height=821&id=ud863a9ee&originHeight=1642&originWidth=2944&originalType=binary&ratio=1&rotation=0&showTitle=false&size=525096&status=done&style=stroke&taskId=uf1d23493-8e8d-4a12-94ba-c96f2b26134&title=&width=1472) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_13.png" class="img-fluid"></p>
<p>And install the downloaded library: <code>Seeed_Arduino_Mic-master.zip</code> on your Arduino IDE: <code>Sketch -&gt; Include Library -&gt; Add .ZIP Library...</code></p>
<!-- ![L17-企业微信20230602-154602\@2x.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685692107316-a6dc7897-631a-4f69-8c19-5006e5e67216.png#averageHue=%2390c277&clientId=ub5d6cce2-8f0f-4&from=ui&id=u9f875294&originHeight=792&originWidth=1894&originalType=binary&ratio=2&rotation=0&showTitle=false&size=406334&status=done&style=stroke&taskId=u25983496-b79e-4e8c-8ec6-e8d986c3580&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_14.png" class="img-fluid"></p>
<p>Next, navigate to <code>File &gt; Examples &gt; Seeed Arduino Mic &gt; mic_Saved_OnSDcard</code> to open the sketch: <strong>mic_Saved_OnSDcard</strong>.</p>
<p>Each time you press the reset button, a <strong>5 seconds audio sample</strong> is recorded and saved on the SD card. I changed the original file to add LEDs to help during the recording process as below:</p>
<ul>
<li>During the time that LED Red is ON is possible to record ==&gt; RECORD</li>
<li>During the file writing process, LED Red is OFF ==&gt; WAIT</li>
<li>When finished writing, LED Green is ON ==&gt; Press Reset Button once and wait for LED Red ON again, and proceed with a new sample recording</li>
</ul>
<p>I realized that sometimes at the beginning and the end of each sample, a “spike” was recorded, so I cut the initial 300ms from each 5s sample. The spike verified at the end always happened after the recording process and should be eliminated on Edge Impulse Studio before training. Also, I increased the microphone gain to 30 dB.</p>
<p>The complete file (Xiao_mic_Saved_OnSDcard.ino) can be found on the Git Hub (3_KWS): <a href="https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense">Seeed-XIAO-BLE-Sense</a>.</p>
<p>During the recording process, the.wav file names are shown on Serial Monitor:</p>
<!-- ![L18-image_I9mglC3IAw.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685696269211-205774ff-0419-4792-b59b-40170b5d1b82.png#averageHue=%23f2f4f0&clientId=u6422ead4-943d-4&from=ui&id=uf5f88742&originHeight=2007&originWidth=2529&originalType=binary&ratio=2&rotation=0&showTitle=false&size=4774534&status=done&style=none&taskId=u04711aa0-20d4-4111-b21e-2f6e14da078&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_15.png" class="img-fluid"></p>
<p>Take the SD card from the Expansion Board and insert it into your computer:</p>
<!-- ![L18-image_ozO8BV0wsG.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685696389225-c4924e7e-d3d1-4d8d-b915-6fb4b48148d5.png#averageHue=%23c3d0e5&clientId=u6422ead4-943d-4&from=ui&id=ub432b882&originHeight=1182&originWidth=2172&originalType=binary&ratio=2&rotation=0&showTitle=false&size=2645893&status=done&style=none&taskId=ue45d5d2d-d7a2-4693-a5e0-f53b15ad4f9&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_16.png" class="img-fluid"></p>
<p>The files are ready to be uploaded to Edge Impulse Studio</p>
</section>
</section>
<section id="capturing-offline-audio-data-with-a-smartphone-or-pc" class="level3">
<h3 class="anchored" data-anchor-id="capturing-offline-audio-data-with-a-smartphone-or-pc">4.3.3.5 Capturing (offline) Audio Data with a smartphone or PC</h3>
<p>Alternatively, you can use your PC or smartphone to capture audio data with a sampling frequency 16KHz and a bit depth of 16 Bits. A good app for that is <a href="https://www.bejbej.ca/app/voicerecordpro">Voice Recorder Pro</a> (IOS). Save your record as .wav files and send them to your computer.</p>
<!-- ![L18-app_yaxj1pljMf.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685696719798-87803373-b19b-403e-a8ba-d569395d5257.png#averageHue=%23ab9972&clientId=u6422ead4-943d-4&from=ui&id=u89ca211c&originHeight=2328&originWidth=3840&originalType=binary&ratio=2&rotation=0&showTitle=false&size=11480352&status=done&style=none&taskId=u81ee6ed5-9678-4133-9808-698d39c721a&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_17.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>Note that any smartphone app can be used for audio recording or even your computer, for example using <a href="https://www.audacityteam.org/">Audacity</a>.</p>
</blockquote>
</section>
<section id="training-model-with-edge-impulse-studio" class="level3">
<h3 class="anchored" data-anchor-id="training-model-with-edge-impulse-studio">4.3.3.6 Training model with Edge Impulse Studio</h3>
<p>When the raw dataset is created, you should initiate a new project at Edge Impulse Studio:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574639880-36bc0112-987e-4ad1-bc08-d168708c8eb9.png#averageHue=%23eaf7ef&clientId=uaddd96ed-c6d3-4&from=paste&height=631&id=u039f9331&originHeight=896&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=483699&status=done&style=none&taskId=u0ff950ae-5baf-4987-98c1-6a5302f3c51&title=&width=901)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_18.png" class="img-fluid"></p>
<p>Once the project is created, go to the <code>Data Acquisition</code> section and select the <code>Upload Existing Data</code> tool. Choose the files to be uploaded, for example, I started uploading the samples recorded with the XIAO nRF52840 Sense:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574658720-7cc92b25-4cb3-42f9-b945-9011467b775d.png#averageHue=%23fbfcf8&clientId=uaddd96ed-c6d3-4&from=paste&height=522&id=ub63a93b3&originHeight=896&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=351834&status=done&style=none&taskId=ua03d7b14-a6f0-487e-8aae-1d2b0dba37b&title=&width=746)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_19.png" class="img-fluid"></p>
<p>The samples will now appear in the <code>Data acquisition</code> section:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574679994-ed5f3048-6c35-45ad-b736-cb5cd6bc9961.png#averageHue=%23f9fcfb&clientId=uaddd96ed-c6d3-4&from=paste&height=511&id=u51384247&originHeight=896&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=388967&status=done&style=none&taskId=u88d881a0-6b6d-43dd-b001-586fbfc181b&title=&width=730)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_20.png" class="img-fluid"></p>
<p>Click on three dots after the sample name and select <code>Split sample</code>. Once inside de tool, split the data into 1-second records (try to avoid start and end portions):</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574704664-5dfd923d-2d8c-436f-9532-aab12f400485.png#averageHue=%23b6c8d3&clientId=uaddd96ed-c6d3-4&from=paste&height=520&id=u86b83505&originHeight=896&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=351455&status=done&style=none&taskId=uce59c33c-442d-4ba2-a976-d893ecedf06&title=&width=743)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_21.png" class="img-fluid"></p>
<p>This procedure should be repeated for all samples. After that, upload other class samples (IESTI and SILENCE) captured with the XIAO and your PC or smartphone.</p>
<blockquote class="blockquote">
<p>Note: For longer audio files (minutes), first, split into 10-second segments and after that, use the tool again to get the final 1-second splits.</p>
</blockquote>
<p>In the end, the dataset has around 70 1-second samples for each class:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574788563-f09e0ff9-248e-415e-bd93-0d707833567a.png#averageHue=%23f3f7f5&clientId=uaddd96ed-c6d3-4&from=paste&height=568&id=u2145f346&originHeight=960&originWidth=1261&originalType=binary&ratio=1&rotation=0&showTitle=false&size=437821&status=done&style=none&taskId=ud4fdcee3-8d62-49d2-b927-77a1b0ebfb9&title=&width=745.4971313476562)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_22.png" class="img-fluid"></p>
<p>Now, you should split that dataset into Train/Test. You can do it manually (using the <code>three dots</code> menu, moving samples individually) or using <code>Perform Train / Test Split</code> on <code>Dashboard - Danger Zone</code>.</p>
<!-- ![](https://cdn.nlark.com/yuque/0/2022/jpeg/2392200/1670807815083-cce34622-1f80-4ecd-b400-c97263eb441e.jpeg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_23.jpeg" class="img-fluid"></p>
<p>We can optionally check all datasets using the tab <code>Data Explorer</code>. The data points seem apart, which means that the classification model should work:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574804384-39fdb1af-f2c1-4ade-b688-a03f9aae980d.png#averageHue=%23eef3e8&clientId=uaddd96ed-c6d3-4&from=paste&height=555&id=ubfc99ff2&originHeight=950&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=328548&status=done&style=none&taskId=ue547460c-aa4d-4150-b2d8-dee00a34a5e&title=&width=748) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_24.png" class="img-fluid"></p>
</section>
<section id="creating-impulse-pre-process-model-definition" class="level3">
<h3 class="anchored" data-anchor-id="creating-impulse-pre-process-model-definition">4.3.3.7 Creating Impulse (Pre-Process / Model definition)</h3>
<p>An impulse takes raw data, uses signal processing to extract features, and then uses a learning block to classify new data.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574820779-46d614d4-ae3f-47e5-858e-4e0e603b87d6.png#averageHue=%239be3ce&clientId=uaddd96ed-c6d3-4&from=paste&height=586&id=ubcf76228&originHeight=960&originWidth=1220&originalType=binary&ratio=1&rotation=0&showTitle=false&size=402575&status=done&style=none&taskId=u474e7e8f-f6e5-4861-bcf0-76747c97aca&title=&width=745)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_25.png" class="img-fluid"></p>
<p>First, we will take the data points with a 1-second window, augmenting the data, sliding that window each 500ms. Note that the option zero-point pad is set. It is important to fill with zeros samples smaller than 1 second in some cases, I reduced the 1000 ms window on the split tool to avoid noises and spikes.</p>
<p>Each 1-second audio sample should be pre-processed and converted to an image (for example, 13 x 50 x 1). We will use <code>Audio (MFCC)</code>, which extracts features from audio signals using <a href="https://en.wikipedia.org/wiki/Mel-frequency_cepstrum">Mel Frequency Cepstral Coefficients</a>, which are well suited for the human voice, which is our case here.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574838689-06fe6e4f-178d-4db1-8e6f-26fffd1b6d27.png#averageHue=%23f7f7f5&clientId=uaddd96ed-c6d3-4&from=paste&height=242&id=ubcf21d25&originHeight=483&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=245017&status=done&style=none&taskId=uf01b73b0-5935-4803-8ed4-2afd5d3ea7a&title=&width=640)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_26.png" class="img-fluid"></p>
<p>Next, we select the <code>Classification</code> block to build our model from scratch using a Convolution Neural Network (CNN).</p>
</section>
<section id="pre-processing-mfcc" class="level3">
<h3 class="anchored" data-anchor-id="pre-processing-mfcc">4.3.3.8 Pre-Processing (MFCC)</h3>
<p>The next step is to create the images to be trained in the next phase:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574851203-a56eefb8-2710-4158-9a4d-1de96058e5b5.png#averageHue=%23eaefec&clientId=uaddd96ed-c6d3-4&from=paste&height=682&id=u044eb65a&originHeight=960&originWidth=1047&originalType=binary&ratio=1&rotation=0&showTitle=false&size=362382&status=done&style=none&taskId=ue3a2cb5a-5e6f-4043-bb37-5413b491272&title=&width=743.4943237304688)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_27.png" class="img-fluid"></p>
<p>We will keep the default parameter values. We do not spend much memory to pre-process data (only 17KB), but the processing time is relatively high (177 ms for a Cortex-M4 CPU as our XIAO). Save parameters and generate features:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574864986-6d89fa30-e259-48ab-9daa-188a613dc5fb.png#averageHue=%23aec7b7&clientId=uaddd96ed-c6d3-4&from=paste&height=658&id=uc032a8ce&originHeight=960&originWidth=1047&originalType=binary&ratio=1&rotation=0&showTitle=false&size=382044&status=done&style=none&taskId=ucd339d59-95a0-4120-8f4f-66b051718d8&title=&width=717.4943237304688) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_28.png" class="img-fluid"></p>
<p><strong>Going under the hood</strong></p>
<p>To understand better how the raw sound is preprocessed, look at the <em>Feature Engineering for Audio Classification</em> chapter. You can play with the MFCC features generation by downloading this <a href="https://github.com/Mjrovai/Arduino_Nicla_Vision/blob/main/KWS/KWS_MFCC_Analysis.ipynb">notebook</a> from GitHub or <a href="https://colab.research.google.com/github/Mjrovai/Arduino_Nicla_Vision/blob/main/KWS/KWS_MFCC_Analysis.ipynb">Opening it In Colab</a>.</p>
</section>
<section id="model-design-and-training" class="level3">
<h3 class="anchored" data-anchor-id="model-design-and-training">4.3.3.9 Model Design and Training</h3>
<p>We will use a simple Convolution Neural Network (CNN) model, tested with 1D and 2D convolutions. The basic architecture has two blocks of Convolution + MaxPooling ([8] and [16] filters, respectively) and a Dropout of [0.25] for the 1D and [0.5] for the 2D. For the last layer, after Flattening, we have [3] neurons, one for each class:</p>
<p><img src="imgs_4-3/model.png" class="img-fluid"></p>
<p>As hyper-parameters, we will have a <code>Learning Rate</code> of [0.005] and a model trained by [100] epochs. We will also include a data augmentation method based on <a href="https://arxiv.org/abs/1904.08779">SpecAugment</a>. We trained the 1D and the 2D models with the same hyperparameters. The 1D architecture had a better overall result (91.1% accuracy) when compared with 88% of the 2D, so we will use the 1D.</p>
<blockquote class="blockquote">
<p>Using 1D convolutions is more efficient because it requires fewer parameters than 2D convolutions, making them more suitable for resource-constrained environments.</p>
</blockquote>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574893876-7fd35816-45ab-4c2d-9d8b-c305399021a1.png#averageHue=%23e3ecdb&clientId=uaddd96ed-c6d3-4&from=paste&height=398&id=ud81f09e4&originHeight=690&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=235253&status=done&style=none&taskId=u5059c89a-fe24-40f8-a64e-320c9d689fe&title=&width=738) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_29.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>If you want to understand what is happening “under the hood,” you can download the pre-processed dataset (<code>MFCC training data</code>) from the <code>Dashboard</code> tab and run this <a href="https://github.com/Mjrovai/Arduino_Nicla_Vision/blob/main/KWS/KWS_CNN_training.ipynb">Jupyter Notebook</a>, playing with the code or <a href="https://colab.research.google.com/github/Mjrovai/Arduino_Nicla_Vision/blob/main/KWS/KWS_CNN_training.ipynb">Opening it In Colab</a>. You should adapt the notebook for your data and model. For example, you can analyze the accuracy by each epoch:</p>
</blockquote>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574906833-68ffb21b-35d0-4872-96ad-99a6c6fd7bd8.png#averageHue=%23f7f7f6&clientId=uaddd96ed-c6d3-4&from=paste&height=363&id=u327200d0&originHeight=725&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=246725&status=done&style=none&taskId=ua14211b8-bef2-4614-b3b6-b1a961f58f5&title=&width=640)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_30.png" class="img-fluid"></p>
</section>
<section id="testing" class="level3">
<h3 class="anchored" data-anchor-id="testing">4.3.3.10 Testing</h3>
<p>Testing the model with the data put apart before training (Test Data), we got an accuracy of 75%. Based on the small amount of data used, it is OK, but I strongly suggest increasing the number of samples.</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574920824-394213b5-d259-448c-892f-731fbea8db68.png#averageHue=%23dcf0df&clientId=uaddd96ed-c6d3-4&from=paste&height=526&id=u61db1a19&originHeight=937&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=467609&status=done&style=none&taskId=u37a9267b-7256-4404-be2e-7a7ac0b45c0&title=&width=718)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_31.png" class="img-fluid"></p>
<p>Collecting more data, the Test accuracy moved up around 5%, going from 75% to around 81%:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670831567845-1249aa1a-c9ce-4ce1-8ab2-7d8c4e262ca6.png#averageHue=%236adcad&clientId=u73aadf43-52e7-4&from=paste&height=279&id=u6bad1dc9&originHeight=558&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=175334&status=done&style=none&taskId=ue9ad1c23-8481-47a5-9c1e-8a39393e5a0&title=&width=640) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_32.png" class="img-fluid"></p>
<p>Now, we can proceed with the project, but before deployment on our device, it is possible to perform Live Classification using a Smart Phone, confirming that the model is working with live and real data:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670574948631-063cbc26-fc53-4368-a673-63535c20db79.png#averageHue=%23c8e17c&clientId=uaddd96ed-c6d3-4&from=paste&height=340&id=u17ba6005&originHeight=582&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=199655&status=done&style=none&taskId=u4b6c09bd-a720-4f08-adee-756ad3f5e99&title=&width=747) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_33.png" class="img-fluid"></p>
</section>
<section id="deploy-and-inference" class="level3">
<h3 class="anchored" data-anchor-id="deploy-and-inference">4.3.3.11 Deploy and Inference</h3>
<p>The Studio will package all the needed libraries, preprocessing functions, and trained models, downloading them to your computer. You should select the option Arduino Library and at the bottom, choose <code>Quantized (Int8)</code> and <code>[Build]</code>.</p>
<!-- ![image.png](/Users/marcelo_rovai/Dropbox/2023/50_MJRoBot/0-XIAO-eBook/Chapter%204/L4-3/deploy.jpg) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_40.png" class="img-fluid"></p>
<p>A Zip file will be created and downloaded to your computer:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="imgs_4-3/deploy-2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">image-20231204104927199</figcaption>
</figure>
</div>
<p>On your Arduino IDE, go to the <code>Sketch</code> tab and select the option <code>Add .ZIP Library</code>.</p>
<!-- ![L17-企业微信20230602-154602\@2x.png](https://cdn.nlark.com/yuque/0/2023/png/2392200/1685692107316-a6dc7897-631a-4f69-8c19-5006e5e67216.png#averageHue=%2390c277&clientId=ub5d6cce2-8f0f-4&from=ui&id=fb2Kq&originHeight=792&originWidth=1894&originalType=binary&ratio=2&rotation=0&showTitle=false&size=406334&status=done&style=stroke&taskId=u25983496-b79e-4e8c-8ec6-e8d986c3580&title=) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_34.png" class="img-fluid"></p>
<p>And Choose the.zip file downloaded by the Studio:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670575001992-240a05cb-fd05-42ad-acae-1175f6df246a.png#averageHue=%23f3f2f0&clientId=uaddd96ed-c6d3-4&from=paste&height=281&id=uf4a07154&originHeight=393&originWidth=1041&originalType=binary&ratio=1&rotation=0&showTitle=false&size=99739&status=done&style=none&taskId=uea6feb86-25fd-438a-bb56-f9c11548bd0&title=&width=745.4971313476562)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_35.png" class="img-fluid"></p>
<p>Now, it is time for a real test. We will make inferences wholly disconnected from the Studio. Let’s change one of the code examples created when you deploy the Arduino Library.</p>
<p>In your Arduino IDE, go to the <code>File/Examples</code> tab and look for your project, and on examples, select <code>nano_ble33_sense_microphone_continuous</code>:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670575011168-1d5c94b2-e4de-4e2a-b3f3-f04198451f61.png#averageHue=%23676864&clientId=uaddd96ed-c6d3-4&from=paste&height=501&id=ub2781cf4&originHeight=827&originWidth=1204&originalType=binary&ratio=1&rotation=0&showTitle=false&size=246497&status=done&style=none&taskId=ua9129c42-4e58-4fff-a22f-70167ce3aa2&title=&width=729.9957275390625)  -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_36.png" class="img-fluid"></p>
<p>Even though the XIAO is not the same as the Arduino, both have the same MPU and PDM microphone, so the code works as it is. Upload the sketch to XIAO and open the Serial Monitor. Start talking about one or another Keyword and confirm that the model is working correctly:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670575022732-f0ce0ce8-9bcd-4a9a-af3a-f9ed630954d1.png#averageHue=%23aeaeae&clientId=uaddd96ed-c6d3-4&from=paste&height=514&id=uc2d58b70&originHeight=665&originWidth=954&originalType=binary&ratio=1&rotation=0&showTitle=false&size=177078&status=done&style=none&taskId=u20ac6882-962f-4b67-aa58-dae7a169963&title=&width=736.9957275390625) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_37.png" class="img-fluid"></p>
</section>
<section id="postprocessing" class="level3">
<h3 class="anchored" data-anchor-id="postprocessing">4.3.3.12 Postprocessing</h3>
<p>Now that we know that the model is working by detecting our two keywords, let’s modify the code so we can see the result with the XIAO nRF52840 Sense completely offline (disconnected from the PC and powered by a battery).</p>
<p>The idea is that whenever the keyword UNIFEI is detected, the LED Red will be ON; if it is IESTI, LED Green will be ON, and if it is SILENCE (No Keyword), both LEDs will be OFF.</p>
<blockquote class="blockquote">
<p>If you have the XIAO nRF52840 Sense installed on the Expansion Board, we can display the class label and its probability. Otherwise, use only the LEDs.</p>
</blockquote>
<p>Let’s go by Parts: Installing and Testing the SSD Display In your Arduino IDE, Install the <a href="https://github.com/olikraus/U8g2_Arduino">u8g2</a> library and run the below code for testing:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Arduino.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;U8x8lib.h&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Wire.h&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>U8X8_SSD1306_128X64_NONAME_HW_I2C u8x8<span class="op">(</span>PIN_WIRE_SCL<span class="op">,</span> PIN_WIRE_SDA<span class="op">,</span> U8X8_PIN_NONE<span class="op">);</span>   </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> setup<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    u8x8<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    u8x8<span class="op">.</span>setFlipMode<span class="op">(</span><span class="dv">0</span><span class="op">);</span>   <span class="co">// set number from 1 to 3, the screen word should rotate 180</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> loop<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    u8x8<span class="op">.</span>setFont<span class="op">(</span>u8x8_font_chroma48medium8_r<span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    u8x8<span class="op">.</span>setCursor<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    u8x8<span class="op">.</span>print<span class="op">(</span><span class="st">"Hello World!"</span><span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And you should see the “Hello World” displayed on the SSD:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670575383601-88429aa0-568b-43b9-8f16-631228134bf7.png#averageHue=%235f675b&clientId=uaddd96ed-c6d3-4&from=paste&height=346&id=u009d1047&originHeight=691&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=764681&status=done&style=none&taskId=u4a3e47d6-656b-4838-a3a7-cb9e3e0a679&title=&width=640) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_38.png" class="img-fluid"></p>
<p>Now, let’s create some functions that, depending on the values of pred_index and pred_value, will trigger the proper LED and display the class and probability. The code below will simulate some inference results and present them on display and LEDs:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">/* Includes ---------------------------------------------------------------- */</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Arduino.h&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;U8x8lib.h&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;Wire.h&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define NUMBER_CLASSES </span><span class="dv">3</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">/** OLED */</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>U8X8_SSD1306_128X64_NONAME_HW_I2C oled<span class="op">(</span>PIN_WIRE_SCL<span class="op">,</span> PIN_WIRE_SDA<span class="op">,</span> U8X8_PIN_NONE<span class="op">);</span>  </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pred_index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>     </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> pred_value <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>String lbl <span class="op">=</span> <span class="st">" "</span><span class="op">;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    pinMode<span class="op">(</span>LEDR<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    pinMode<span class="op">(</span>LEDG<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    pinMode<span class="op">(</span>LEDB<span class="op">,</span> OUTPUT<span class="op">);</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    digitalWrite<span class="op">(</span>LEDR<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    digitalWrite<span class="op">(</span>LEDG<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    digitalWrite<span class="op">(</span>LEDB<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>begin<span class="op">();</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>setFlipMode<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>setFont<span class="op">(</span>u8x8_font_chroma48medium8_r<span class="op">);</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>setCursor<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>print<span class="op">(</span><span class="st">" XIAO Sense KWS"</span><span class="op">);</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">* </span><span class="an">@brief</span><span class="co">      turn_off_leds function - turn-off all RGB LEDs</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> turn_off_leds<span class="op">(){</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    digitalWrite<span class="op">(</span>LEDR<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    digitalWrite<span class="op">(</span>LEDG<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    digitalWrite<span class="op">(</span>LEDB<span class="op">,</span> HIGH<span class="op">);</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co">* </span><span class="an">@brief</span><span class="co">      Show Inference Results on OLED Display</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> display_oled<span class="op">(</span><span class="dt">int</span> pred_index<span class="op">,</span> <span class="dt">float</span> pred_value<span class="op">){</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">switch</span> <span class="op">(</span>pred_index<span class="op">){</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>            turn_off_leds<span class="op">();</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            digitalWrite<span class="op">(</span>LEDG<span class="op">,</span> LOW<span class="op">);</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>            lbl <span class="op">=</span> <span class="st">"IESTI  "</span> <span class="op">;</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>            turn_off_leds<span class="op">();</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>            lbl <span class="op">=</span> <span class="st">"SILENCE"</span><span class="op">;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>            turn_off_leds<span class="op">();</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>            digitalWrite<span class="op">(</span>LEDR<span class="op">,</span> LOW<span class="op">);</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>            lbl <span class="op">=</span> <span class="st">"UNIFEI "</span><span class="op">;</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>setCursor<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>print<span class="op">(</span><span class="st">"      "</span><span class="op">);</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>setCursor<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>print<span class="op">(</span><span class="st">"Label:"</span><span class="op">);</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>print<span class="op">(</span>lbl<span class="op">);</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>setCursor<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">6</span><span class="op">);</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>print<span class="op">(</span><span class="st">"Prob.:"</span><span class="op">);</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    oled<span class="op">.</span>print<span class="op">(</span>pred_value<span class="op">);</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> NUMBER_CLASSES<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span> </span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        pred_index <span class="op">=</span> i<span class="op">;</span>     </span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        pred_value <span class="op">=</span> <span class="fl">0.8</span><span class="op">;</span>   </span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        display_oled<span class="op">(</span>pred_index<span class="op">,</span> pred_value<span class="op">);</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        delay<span class="op">(</span><span class="dv">2000</span><span class="op">);</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Running the above code, you should get the below result:</p>
<!-- ![image.png](https://cdn.nlark.com/yuque/0/2022/png/2392200/1670575400385-3e2f9033-8229-4704-a80a-8ad4d0c2e8ea.png#averageHue=%23446960&clientId=uaddd96ed-c6d3-4&from=paste&height=360&id=u9553b381&originHeight=720&originWidth=1280&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1195192&status=done&style=none&taskId=ud85fa751-e381-469e-9feb-8fd3f212ee0&title=&width=640) -->
<p><img src="https://files.seeedstudio.com/wiki/XIAO_Big_Power-Board-ebook-photo/chapter_4-3/chapter_4-3_39.png" class="img-fluid"></p>
<p>You should merge the above code (Initialization and functions) with the <code>nano_ble33_sense_microphone_continuous.ino</code> you initially used to test your model. Also, you should include the below code on <code>loop()</code> between the lines:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ei_printf<span class="op">(</span><span class="st">": </span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#if EI_CLASSIFIER_HAS_ANOMALY == 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And replacing the original function to print inference results on the Serial Monitor:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> pred_index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>     <span class="co">// Initialize pred_index</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> pred_value <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// Initialize pred_value</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> ix <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> ix <span class="op">&lt;</span> EI_CLASSIFIER_LABEL_COUNT<span class="op">;</span> ix<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    ei_printf<span class="op">(</span><span class="st">"    </span><span class="sc">%s</span><span class="st">: </span><span class="sc">%.5f\n</span><span class="st">"</span><span class="op">,</span> result<span class="op">.</span>classification<span class="op">[</span>ix<span class="op">].</span>label<span class="op">,</span> result<span class="op">.</span>classification<span class="op">[</span>ix<span class="op">].</span>value<span class="op">);</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>result<span class="op">.</span>classification<span class="op">[</span>ix<span class="op">].</span>value <span class="op">&gt;</span> pred_value<span class="op">){</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        pred_index <span class="op">=</span> ix<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        pred_value <span class="op">=</span> result<span class="op">.</span>classification<span class="op">[</span>ix<span class="op">].</span>value<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>display_oled<span class="op">(</span>pred_index<span class="op">,</span> pred_value<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here you can see how the final project is: https://youtu.be/1ex88hSqqyI</p>
<blockquote class="blockquote">
<p>The complete code can be found on the GitHub (3_KWS): <a href="https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense">Seeed-XIAO-BLE-Sense</a>.</p>
</blockquote>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">4.3.3.13 Conclusion</h3>
<p>The Seeed XIAO nRF52840 Sense is really a giant tiny device! However, it is powerful, trustworthy, not expensive, low power, and has suitable sensors to be used on the most common embedded machine learning applications such as movement and sound.</p>
<p>Even though Edge Impulse does not officially support XIAO nRF52840 Sense (yet!), we also realized that it could use Studio for training and deployment.</p>
<blockquote class="blockquote">
<p>On the GitHub repository, you will find the last version of the codes in the 3_KWS folder: <a href="https://github.com/Mjrovai/Seeed-XIAO-BLE-Sense">Seeed-XIAO-BLE-Sense</a></p>
</blockquote>
<p>Before we finish, consider that Sound Classification is more than just voice. For example, you can develop TinyML projects around sound in several areas as:</p>
<ul>
<li>Security (Broken Glass detection)</li>
<li>Industry (Anomaly Detection)</li>
<li>Medical (Snore, Toss, Pulmonary diseases)</li>
<li>Nature (Beehive control, insect sound)</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          // default icon
          link.classList.add("external");
      }
    }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./chapter_4-2.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">4.2 TinyML Made Easy: Anomaly Detection &amp; Motion Classification</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./chapter_4-4.html" class="pagination-link">
        <span class="nav-page-text">4.4 TinyML Made Easy: Image Classification</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">XIAO: Big Power, Small Board</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>